import{d as W,r as g,j as X,a3 as Y,c as b,a as l,w as a,o as u,b as s,m as T,n,i as d,l as U,F as h,D as ee}from"./index-DAZDpghP.js";import{E as te}from"./dialog-CI4qXYgt.js";import{E as le,a as ae}from"./form-item-D50nbGgb.js";import{E as se}from"./input-BsUoEHjr.js";import{E as oe}from"./input-number-BUSsIkB9.js";import{E as ie}from"./divider-BbpLxVZK.js";import{E as ne,a as me}from"./col-1pbAQj7U.js";import{E as re}from"./progress-CA3fGClE.js";import{E as ue,a as de}from"./timeline-item-D2GMA4fJ.js";import{a as pe,E as ce}from"./table-column-CkszfM6q.js";import"./checkbox-DDntw5na.js";import"./scrollbar-BKn1N4ug.js";import{E as fe}from"./popover--wAAUrH1.js";import{E as ve}from"./button-CFFx6FdR.js";import{E as _e}from"./switch-BV5hNiQp.js";/* empty css            */import{E as ge}from"./card-_e8Y2itV.js";import{E as be}from"./index-i9SNigSW.js";import{E as k}from"./index-B4p_U5VT.js";import{_ as xe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./event-D5_Wo8Xc.js";import"./scroll-PXqKi88e.js";import"./index-17xiCnpu.js";import"./_baseClone-BBryStzM.js";import"./index-BBjiecLk.js";import"./isPlainObject-CnEW4LJ3.js";import"./_baseIteratee-DgY2c_zD.js";import"./isEqual-DlB8YXyV.js";import"./debounce-Bv_84CHO.js";import"./validator-BGx-pjuX.js";const Ve={class:"auto-scaling-page p-5"},Te={class:"flex items-center justify-between"},Ee={class:"text-sm"},ye={key:0},Re={key:1},Ue={key:2},Ne={key:3},Se={class:"font-bold"},ke={class:"text-sm text-gray-600"},Ce={class:"text-sm text-gray-500"},Pe={class:"metrics-panel"},ze={class:"metric-item"},Me={class:"metric-value"},Ie={class:"text-2xl font-bold"},Ze={class:"metric-item mt-4"},Fe={class:"metric-value text-3xl font-bold text-blue-600"},qe={class:"metric-item mt-4"},we={class:"metric-value text-3xl font-bold text-green-600"},De={class:"metric-item mt-4"},Je={class:"metric-value text-3xl font-bold text-purple-600"},Oe={class:"metric-item mt-4"},Be={class:"metric-value text-3xl font-bold text-orange-600"},Ge=W({__name:"auto-scaling",setup(Qe){const p=g([]),E=g([]),_=g(!1),x=g(!1),r=g({gpuUtilization:65,qps:120,tps:850,ttft:180,currentReplicas:3}),o=g({ruleName:"",serviceName:"",metrics:{gpuUtilization:80,qps:100,tps:1e3,ttft:200},minReplicas:1,maxReplicas:10,scaleToZero:!0,scaleToZeroTimeout:10,enabled:!0});let N;function I(){return{rules:[{id:"1",ruleName:"llama2-auto-scaling",serviceName:"llama2-7b-service",metrics:{gpuUtilization:80,qps:100,ttft:200},minReplicas:1,maxReplicas:10,scaleToZero:!0,scaleToZeroTimeout:10,enabled:!0},{id:"2",ruleName:"chatglm-auto-scaling",serviceName:"chatglm-6b-service",metrics:{gpuUtilization:75,tps:1e3},minReplicas:2,maxReplicas:8,scaleToZero:!1,enabled:!0}],events:[{id:"1",serviceName:"llama2-7b-service",action:"扩容",fromReplicas:2,toReplicas:3,reason:"GPU利用率达到85%，超过阈值80%",timestamp:"2024-01-15 14:30:00",type:"success"},{id:"2",serviceName:"chatglm-6b-service",action:"扩容",fromReplicas:2,toReplicas:4,reason:"QPS达到150，超过阈值100",timestamp:"2024-01-15 13:15:00",type:"success"},{id:"3",serviceName:"llama2-7b-service",action:"缩容",fromReplicas:3,toReplicas:1,reason:"10分钟无请求，触发缩容到0",timestamp:"2024-01-15 11:00:00",type:"info"}]}}function Z(){N=window.setInterval(()=>{r.value.gpuUtilization=Math.floor(Math.random()*40+50),r.value.qps=Math.floor(Math.random()*100+80),r.value.tps=Math.floor(Math.random()*500+600),r.value.ttft=Math.floor(Math.random()*100+150)},3e3)}function F(i){return i<50?"#67C23A":i<80?"#E6A23C":"#F56C6C"}function q(i){x.value=!0,o.value={...i},_.value=!0}function w(){if(x.value&&o.value.id){const i=p.value.findIndex(e=>e.id===o.value.id);i!==-1&&(p.value[i]={...o.value})}else{const i={...o.value,id:Date.now().toString()};p.value.push(i)}y(),_.value=!1,O(),k.success(x.value?"规则更新成功":"规则创建成功")}function D(i){p.value=p.value.filter(e=>e.id!==i),y(),k.success("规则删除成功")}function J(i){y(),k.success(i.enabled?"规则已启用":"规则已禁用")}function O(){x.value=!1,o.value={ruleName:"",serviceName:"",metrics:{gpuUtilization:80,qps:100,tps:1e3,ttft:200},minReplicas:1,maxReplicas:10,scaleToZero:!0,scaleToZeroTimeout:10,enabled:!0}}function y(){localStorage.setItem("scaling-rules",JSON.stringify(p.value)),localStorage.setItem("scaling-events",JSON.stringify(E.value))}function B(){const i=localStorage.getItem("scaling-rules"),e=localStorage.getItem("scaling-events");if(!i||!e||JSON.parse(i).length===0||JSON.parse(e).length===0){const c=I();p.value=c.rules,E.value=c.events,y()}else p.value=JSON.parse(i),E.value=JSON.parse(e)}return X(()=>{B(),Z()}),Y(()=>{N&&clearInterval(N)}),(i,e)=>{const c=ge,V=ve,f=ce,C=be,S=_e,G=fe,Q=pe,$=de,j=ue,P=me,A=re,L=ne,z=se,m=ae,M=ie,v=oe,H=le,K=te;return u(),b("div",Ve,[l(c,{class:"header-card"},{default:a(()=>e[14]||(e[14]=[s("h2",{class:"text-2xl font-bold mb-2"},"基于推理指标的弹性扩缩容",-1),s("p",{class:"text-gray-500"}," 支持根据GPU利用率、QPS、TPS、TTFT指标进行弹性扩缩容，以应对高峰流量 ",-1)])),_:1,__:[14]}),l(L,{gutter:20,class:"mt-4"},{default:a(()=>[l(P,{span:16},{default:a(()=>[l(c,null,{header:a(()=>[s("div",Te,[e[16]||(e[16]=s("span",{class:"font-bold"},"扩缩容规则",-1)),l(V,{type:"primary",onClick:e[0]||(e[0]=t=>_.value=!0)},{default:a(()=>e[15]||(e[15]=[d(" 创建规则 ",-1)])),_:1,__:[15]})])]),default:a(()=>[l(Q,{data:p.value,stripe:""},{default:a(()=>[l(f,{prop:"ruleName",label:"规则名称",width:"180"}),l(f,{prop:"serviceName",label:"服务名称",width:"150"}),l(f,{label:"扩缩容指标",width:"250"},{default:a(({row:t})=>[s("div",Ee,[t.metrics.gpuUtilization?(u(),b("div",ye," GPU利用率 > "+n(t.metrics.gpuUtilization)+"% ",1)):T("",!0),t.metrics.qps?(u(),b("div",Re,"QPS > "+n(t.metrics.qps),1)):T("",!0),t.metrics.tps?(u(),b("div",Ue,"TPS > "+n(t.metrics.tps),1)):T("",!0),t.metrics.ttft?(u(),b("div",Ne,"TTFT > "+n(t.metrics.ttft)+"ms",1)):T("",!0)])]),_:1}),l(f,{label:"副本范围",width:"120",align:"center"},{default:a(({row:t})=>[d(n(t.minReplicas)+" - "+n(t.maxReplicas),1)]),_:1}),l(f,{label:"缩容到0",width:"100",align:"center"},{default:a(({row:t})=>[t.scaleToZero?(u(),U(C,{key:0,type:"success",size:"small"},{default:a(()=>e[17]||(e[17]=[d(" 支持 ",-1)])),_:1,__:[17]})):(u(),U(C,{key:1,type:"info",size:"small"},{default:a(()=>e[18]||(e[18]=[d(" 不支持 ",-1)])),_:1,__:[18]}))]),_:1}),l(f,{label:"状态",width:"100",align:"center"},{default:a(({row:t})=>[l(S,{modelValue:t.enabled,"onUpdate:modelValue":R=>t.enabled=R,onChange:R=>J(t)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),l(f,{label:"操作",width:"150",fixed:"right"},{default:a(({row:t})=>[l(V,{link:"",type:"primary",onClick:R=>q(t)},{default:a(()=>e[19]||(e[19]=[d(" 编辑 ",-1)])),_:2,__:[19]},1032,["onClick"]),l(G,{title:"确定要删除此规则吗？",onConfirm:R=>D(t.id)},{reference:a(()=>[l(V,{link:"",type:"danger"},{default:a(()=>e[20]||(e[20]=[d("删除",-1)])),_:1,__:[20]})]),_:2},1032,["onConfirm"])]),_:1})]),_:1},8,["data"])]),_:1}),l(c,{class:"mt-4"},{header:a(()=>e[21]||(e[21]=[s("span",{class:"font-bold"},"扩缩容历史",-1)])),default:a(()=>[l(j,null,{default:a(()=>[(u(!0),b(h,null,ee(E.value,t=>(u(),U($,{key:t.id,timestamp:t.timestamp,type:t.type,placement:"top"},{default:a(()=>[s("div",Se,n(t.serviceName),1),s("div",ke,n(t.action)+"："+n(t.fromReplicas)+" → "+n(t.toReplicas)+" 副本 ",1),s("div",Ce,"触发原因："+n(t.reason),1)]),_:2},1032,["timestamp","type"]))),128))]),_:1})]),_:1})]),_:1}),l(P,{span:8},{default:a(()=>[l(c,null,{header:a(()=>e[22]||(e[22]=[s("span",{class:"font-bold"},"实时监控指标",-1)])),default:a(()=>[s("div",Pe,[s("div",ze,[e[23]||(e[23]=s("div",{class:"metric-label"},"GPU利用率",-1)),s("div",Me,[l(A,{type:"dashboard",percentage:r.value.gpuUtilization,color:F(r.value.gpuUtilization)},{default:a(({percentage:t})=>[s("span",Ie,n(t)+"%",1)]),_:1},8,["percentage","color"])])]),s("div",Ze,[e[24]||(e[24]=s("div",{class:"metric-label"},"QPS (每秒查询数)",-1)),s("div",Fe,n(r.value.qps),1)]),s("div",qe,[e[25]||(e[25]=s("div",{class:"metric-label"},"TPS (每秒Token数)",-1)),s("div",we,n(r.value.tps),1)]),s("div",De,[e[26]||(e[26]=s("div",{class:"metric-label"},"TTFT (首Token时间)",-1)),s("div",Je,n(r.value.ttft)+" ms ",1)]),s("div",Oe,[e[27]||(e[27]=s("div",{class:"metric-label"},"当前副本数",-1)),s("div",Be,n(r.value.currentReplicas),1)])])]),_:1})]),_:1})]),_:1}),l(K,{modelValue:_.value,"onUpdate:modelValue":e[13]||(e[13]=t=>_.value=t),title:x.value?"编辑扩缩容规则":"创建扩缩容规则",width:"700px"},{footer:a(()=>[l(V,{onClick:e[12]||(e[12]=t=>_.value=!1)},{default:a(()=>e[36]||(e[36]=[d("取消",-1)])),_:1,__:[36]}),l(V,{type:"primary",onClick:w},{default:a(()=>e[37]||(e[37]=[d("保存",-1)])),_:1,__:[37]})]),default:a(()=>[l(H,{model:o.value,"label-width":"140px"},{default:a(()=>[l(m,{label:"规则名称"},{default:a(()=>[l(z,{modelValue:o.value.ruleName,"onUpdate:modelValue":e[1]||(e[1]=t=>o.value.ruleName=t),placeholder:"请输入规则名称"},null,8,["modelValue"])]),_:1}),l(m,{label:"服务名称"},{default:a(()=>[l(z,{modelValue:o.value.serviceName,"onUpdate:modelValue":e[2]||(e[2]=t=>o.value.serviceName=t),placeholder:"请输入服务名称"},null,8,["modelValue"])]),_:1}),l(M,{"content-position":"left"},{default:a(()=>e[28]||(e[28]=[d("扩缩容触发指标",-1)])),_:1,__:[28]}),l(m,{label:"GPU利用率阈值(%)"},{default:a(()=>[l(v,{modelValue:o.value.metrics.gpuUtilization,"onUpdate:modelValue":e[3]||(e[3]=t=>o.value.metrics.gpuUtilization=t),min:0,max:100},null,8,["modelValue"]),e[29]||(e[29]=s("span",{class:"ml-2 text-gray-500 text-sm"},"超过此值触发扩容",-1))]),_:1,__:[29]}),l(m,{label:"QPS阈值"},{default:a(()=>[l(v,{modelValue:o.value.metrics.qps,"onUpdate:modelValue":e[4]||(e[4]=t=>o.value.metrics.qps=t),min:0,step:10},null,8,["modelValue"]),e[30]||(e[30]=s("span",{class:"ml-2 text-gray-500 text-sm"},"超过此值触发扩容",-1))]),_:1,__:[30]}),l(m,{label:"TPS阈值"},{default:a(()=>[l(v,{modelValue:o.value.metrics.tps,"onUpdate:modelValue":e[5]||(e[5]=t=>o.value.metrics.tps=t),min:0,step:100},null,8,["modelValue"]),e[31]||(e[31]=s("span",{class:"ml-2 text-gray-500 text-sm"},"超过此值触发扩容",-1))]),_:1,__:[31]}),l(m,{label:"TTFT阈值(ms)"},{default:a(()=>[l(v,{modelValue:o.value.metrics.ttft,"onUpdate:modelValue":e[6]||(e[6]=t=>o.value.metrics.ttft=t),min:0,step:50},null,8,["modelValue"]),e[32]||(e[32]=s("span",{class:"ml-2 text-gray-500 text-sm"},"超过此值触发扩容",-1))]),_:1,__:[32]}),l(M,{"content-position":"left"},{default:a(()=>e[33]||(e[33]=[d("副本配置",-1)])),_:1,__:[33]}),l(m,{label:"最小副本数"},{default:a(()=>[l(v,{modelValue:o.value.minReplicas,"onUpdate:modelValue":e[7]||(e[7]=t=>o.value.minReplicas=t),min:0,max:10},null,8,["modelValue"])]),_:1}),l(m,{label:"最大副本数"},{default:a(()=>[l(v,{modelValue:o.value.maxReplicas,"onUpdate:modelValue":e[8]||(e[8]=t=>o.value.maxReplicas=t),min:1,max:20},null,8,["modelValue"])]),_:1}),l(m,{label:"支持缩容到0"},{default:a(()=>[l(S,{modelValue:o.value.scaleToZero,"onUpdate:modelValue":e[9]||(e[9]=t=>o.value.scaleToZero=t)},null,8,["modelValue"]),e[34]||(e[34]=s("span",{class:"ml-2 text-gray-500 text-sm"},"一段时间无请求后缩容到0",-1))]),_:1,__:[34]}),o.value.scaleToZero?(u(),U(m,{key:0,label:"缩容等待时间"},{default:a(()=>[l(v,{modelValue:o.value.scaleToZeroTimeout,"onUpdate:modelValue":e[10]||(e[10]=t=>o.value.scaleToZeroTimeout=t),min:1,max:60},null,8,["modelValue"]),e[35]||(e[35]=s("span",{class:"ml-2 text-gray-500 text-sm"},"分钟",-1))]),_:1,__:[35]})):T("",!0),l(m,{label:"启用规则"},{default:a(()=>[l(S,{modelValue:o.value.enabled,"onUpdate:modelValue":e[11]||(e[11]=t=>o.value.enabled=t)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}}),Vt=xe(Ge,[["__scopeId","data-v-c7512504"]]);export{Vt as default};
