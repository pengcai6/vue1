import{d as G,r as f,D as C,j as H,c as J,a as e,w as t,o as x,b as A,i,p as r,E as K,e as Q,bf as Y,m as Z,n as ee,l as ae,_ as te}from"./index-BX2sZVyW.js";import{E as le}from"./dialog-BbJ9SoMc.js";import{E as oe,a as se}from"./descriptions-item-CLkKtAVA.js";import{E as ne}from"./card-B6phTZGW.js";import{E as ie}from"./pagination-uLtAnqW5.js";/* empty css            */import{E as ue,a as re}from"./select-9k77N6f3.js";import"./scrollbar-C9NSq6wy.js";import{E as de}from"./input-5aB7ALv6.js";import{a as pe,E as me}from"./table-column-DG__lvqo.js";import"./checkbox-B8dDd1Mj.js";import{E as ce,a as ge}from"./form-item-BCUJoI1X.js";import{E as _e}from"./date-picker-CMS_m3WO.js";import{E as ye}from"./button-Cn9gqGCu.js";import{E as fe}from"./index-BFcHm1-Q.js";import"./event-BORzi4vc.js";import"./scroll-g5r06U3K.js";import"./index-PwB6y63X.js";import"./isEqual-ohjdCfDM.js";import"./strings-JcT2fde-.js";import"./debounce-DYp1oJWc.js";import"./isPlainObject-jZyBOBeK.js";import"./_baseClone-BOpOh07B.js";import"./index-BDj3Pv7k.js";const ve={class:"audit-log-page"},Te={class:"card-header"},be={class:"pagination"},he=G({__name:"audit-log",setup(we){const s=f({logType:"",actionType:"",userName:"",ipAddress:"",dateRange:[]}),I=f([]),_=f(1),v=f(10),b=f(!1),n=f(null),q=()=>{const l=[{id:"log-001",logType:"login",actionType:"login",userName:"张三",userId:"user-001",module:"用户认证",description:"用户登录系统",ipAddress:"192.168.1.100",location:"北京市 朝阳区",userAgent:"Mozilla/5.0 (Windows NT 10.0; Win64; x64) Chrome/120.0.0.0",status:"success",timestamp:"2024-06-20 09:15:23",duration:156,requestPath:"/api/auth/login",requestParams:'{"username": "zhangsan", "loginType": "password"}'},{id:"log-002",logType:"operation",actionType:"create",userName:"张三",userId:"user-001",module:"模型部署",description:"创建模型部署服务: qwen-chat-api",ipAddress:"192.168.1.100",location:"北京市 朝阳区",userAgent:"Mozilla/5.0 (Windows NT 10.0; Win64; x64) Chrome/120.0.0.0",status:"success",timestamp:"2024-06-20 09:30:45",duration:2340,requestPath:"/api/deployment/create",requestParams:'{"modelId": "model-001", "instanceType": "gpu.a100.1x", "replicas": 2}'},{id:"log-003",logType:"operation",actionType:"update",userName:"李四",userId:"user-002",module:"数据集管理",description:"更新数据集: 客服对话数据集",ipAddress:"192.168.1.105",location:"上海市 浦东新区",userAgent:"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) Safari/605.1.15",status:"success",timestamp:"2024-06-20 10:12:18",duration:567,requestPath:"/api/dataset/update",requestParams:'{"datasetId": "dataset-001", "description": "更新数据集描述"}'},{id:"log-004",logType:"operation",actionType:"delete",userName:"王五",userId:"user-003",module:"模型微调",description:"删除微调任务: task-finetune-123",ipAddress:"192.168.1.110",location:"深圳市 南山区",userAgent:"Mozilla/5.0 (Windows NT 10.0; Win64; x64) Edge/120.0.0.0",status:"success",timestamp:"2024-06-20 11:25:33",duration:234,requestPath:"/api/finetune/delete",requestParams:'{"taskId": "task-finetune-123"}'},{id:"log-005",logType:"login",actionType:"login",userName:"admin",userId:"user-admin",module:"用户认证",description:"管理员登录失败 - 密码错误",ipAddress:"203.0.113.45",location:"未知地区",userAgent:"Mozilla/5.0 (X11; Linux x86_64) Firefox/120.0",status:"failed",timestamp:"2024-06-20 12:05:12",duration:89,requestPath:"/api/auth/login",requestParams:'{"username": "admin", "loginType": "password"}'},{id:"log-006",logType:"operation",actionType:"create",userName:"赵六",userId:"user-004",module:"模型测评",description:"创建模型测评任务",ipAddress:"192.168.1.115",location:"杭州市 西湖区",userAgent:"Mozilla/5.0 (Windows NT 10.0; Win64; x64) Chrome/120.0.0.0",status:"success",timestamp:"2024-06-20 13:40:56",duration:1234,requestPath:"/api/evaluation/create",requestParams:'{"modelId": "model-002", "benchmarks": ["MMLU", "C-Eval"]}'},{id:"log-007",logType:"system",actionType:"update",userName:"system",userId:"system",module:"系统配置",description:"自动扩缩容规则触发 - GPU利用率超过80%",ipAddress:"127.0.0.1",location:"本地",userAgent:"System Internal",status:"success",timestamp:"2024-06-20 14:15:30",duration:3456,requestPath:"/internal/autoscaling/trigger",requestParams:'{"serviceId": "service-001", "metric": "gpu_utilization", "value": 0.85}'},{id:"log-008",logType:"operation",actionType:"query",userName:"钱七",userId:"user-005",module:"模型广场",description:"查询模型列表",ipAddress:"192.168.1.120",location:"广州市 天河区",userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 17_0 like Mac OS X) Safari/604.1",status:"success",timestamp:"2024-06-20 15:22:45",duration:123,requestPath:"/api/models/list",requestParams:'{"category": "chat", "pageSize": 20}'}];I.value=l},k=()=>{q()},h=C(()=>{let l=I.value;if(s.value.logType&&(l=l.filter(a=>a.logType===s.value.logType)),s.value.actionType&&(l=l.filter(a=>a.actionType===s.value.actionType)),s.value.userName&&(l=l.filter(a=>a.userName.toLowerCase().includes(s.value.userName.toLowerCase()))),s.value.ipAddress&&(l=l.filter(a=>a.ipAddress.includes(s.value.ipAddress))),s.value.dateRange&&s.value.dateRange.length===2){const[a,T]=s.value.dateRange;l=l.filter(c=>{const d=new Date(c.timestamp).getTime();return d>=a.getTime()&&d<=T.getTime()})}return l}),z=C(()=>{const l=(_.value-1)*v.value,a=l+v.value;return h.value.slice(l,a)}),L=()=>{_.value=1},U=()=>{s.value={logType:"",actionType:"",userName:"",ipAddress:"",dateRange:[]},_.value=1},D=l=>{n.value=l,b.value=!0},M=()=>{const l=["日志ID","日志类型","操作类型","用户","模块","操作描述","IP地址","状态","时间"],a=h.value.map(u=>[u.id,w(u.logType),E(u.actionType),u.userName,u.module,`"${u.description.replace(/"/g,'""')}"`,u.ipAddress,u.status==="success"?"成功":"失败",u.timestamp]),T=[l.join(","),...a.map(u=>u.join(","))].join(`
`),c=new Blob(["\uFEFF"+T],{type:"text/csv;charset=utf-8;"}),d=URL.createObjectURL(c),g=document.createElement("a");g.href=d,g.download=`audit-logs-${Date.now()}.csv`,document.body.appendChild(g),g.click(),document.body.removeChild(g),URL.revokeObjectURL(d),ae.success("日志导出成功")},w=l=>({login:"登录",operation:"操作",system:"系统"})[l]||l,N=l=>({login:"primary",operation:"success",system:"warning"})[l]||"",E=l=>({create:"创建",update:"更新",delete:"删除",query:"查询",login:"登录",logout:"登出"})[l]||l,V=l=>({create:"success",update:"warning",delete:"danger",query:"info",login:"primary",logout:"info"})[l]||"",S=l=>{v.value=l,_.value=1},R=l=>{_.value=l};return H(()=>{k()}),(l,a)=>{const T=K,c=ye,d=re,g=ue,u=ge,P=de,W=_e,j=ce,m=me,y=fe,F=pe,B=ie,O=ne,p=oe,X=se,$=le;return x(),J("div",ve,[e(O,null,{header:t(()=>[A("div",Te,[a[10]||(a[10]=A("span",{class:"title"},"审计日志",-1)),e(c,{type:"primary",onClick:M},{default:t(()=>[e(T,null,{default:t(()=>[e(Q(Y))]),_:1}),a[9]||(a[9]=i(" 导出日志 ",-1))]),_:1,__:[9]})])]),default:t(()=>[e(j,{inline:!0,class:"search-form"},{default:t(()=>[e(u,{label:"日志类型"},{default:t(()=>[e(g,{modelValue:s.value.logType,"onUpdate:modelValue":a[0]||(a[0]=o=>s.value.logType=o),placeholder:"请选择日志类型",clearable:"",style:{width:"150px"}},{default:t(()=>[e(d,{label:"全部",value:""}),e(d,{label:"登录日志",value:"login"}),e(d,{label:"操作日志",value:"operation"}),e(d,{label:"系统日志",value:"system"})]),_:1},8,["modelValue"])]),_:1}),e(u,{label:"操作类型"},{default:t(()=>[e(g,{modelValue:s.value.actionType,"onUpdate:modelValue":a[1]||(a[1]=o=>s.value.actionType=o),placeholder:"请选择操作类型",clearable:"",style:{width:"150px"}},{default:t(()=>[e(d,{label:"全部",value:""}),e(d,{label:"创建",value:"create"}),e(d,{label:"更新",value:"update"}),e(d,{label:"删除",value:"delete"}),e(d,{label:"查询",value:"query"})]),_:1},8,["modelValue"])]),_:1}),e(u,{label:"用户"},{default:t(()=>[e(P,{modelValue:s.value.userName,"onUpdate:modelValue":a[2]||(a[2]=o=>s.value.userName=o),placeholder:"请输入用户名",clearable:"",style:{width:"150px"}},null,8,["modelValue"])]),_:1}),e(u,{label:"IP地址"},{default:t(()=>[e(P,{modelValue:s.value.ipAddress,"onUpdate:modelValue":a[3]||(a[3]=o=>s.value.ipAddress=o),placeholder:"请输入IP地址",clearable:"",style:{width:"150px"}},null,8,["modelValue"])]),_:1}),e(u,{label:"时间范围"},{default:t(()=>[e(W,{modelValue:s.value.dateRange,"onUpdate:modelValue":a[4]||(a[4]=o=>s.value.dateRange=o),type:"datetimerange","range-separator":"至","start-placeholder":"开始时间","end-placeholder":"结束时间",style:{width:"380px"}},null,8,["modelValue"])]),_:1}),e(u,null,{default:t(()=>[e(c,{type:"primary",onClick:L},{default:t(()=>a[11]||(a[11]=[i("查询",-1)])),_:1,__:[11]}),e(c,{onClick:U},{default:t(()=>a[12]||(a[12]=[i("重置",-1)])),_:1,__:[12]})]),_:1})]),_:1}),e(F,{data:z.value,border:"",style:{width:"100%"}},{default:t(()=>[e(m,{prop:"id",label:"日志ID",width:"140"}),e(m,{prop:"logType",label:"日志类型",width:"100",align:"center"},{default:t(({row:o})=>[e(y,{type:N(o.logType)},{default:t(()=>[i(r(w(o.logType)),1)]),_:2},1032,["type"])]),_:1}),e(m,{prop:"actionType",label:"操作类型",width:"100",align:"center"},{default:t(({row:o})=>[e(y,{type:V(o.actionType)},{default:t(()=>[i(r(E(o.actionType)),1)]),_:2},1032,["type"])]),_:1}),e(m,{prop:"userName",label:"用户",width:"120"}),e(m,{prop:"module",label:"模块",width:"120"}),e(m,{prop:"description",label:"操作描述","min-width":"250","show-overflow-tooltip":""}),e(m,{prop:"ipAddress",label:"IP地址",width:"140"}),e(m,{prop:"userAgent",label:"浏览器",width:"150","show-overflow-tooltip":""}),e(m,{prop:"status",label:"状态",width:"80",align:"center"},{default:t(({row:o})=>[e(y,{type:o.status==="success"?"success":"danger"},{default:t(()=>[i(r(o.status==="success"?"成功":"失败"),1)]),_:2},1032,["type"])]),_:1}),e(m,{prop:"timestamp",label:"时间",width:"180"}),e(m,{label:"操作",width:"100",fixed:"right"},{default:t(({row:o})=>[e(c,{link:"",type:"primary",size:"small",onClick:Ee=>D(o)},{default:t(()=>a[13]||(a[13]=[i("详情",-1)])),_:2,__:[13]},1032,["onClick"])]),_:1})]),_:1},8,["data"]),A("div",be,[e(B,{"current-page":_.value,"onUpdate:currentPage":a[5]||(a[5]=o=>_.value=o),"page-size":v.value,"onUpdate:pageSize":a[6]||(a[6]=o=>v.value=o),"page-sizes":[10,20,50,100],total:h.value.length,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:S,onCurrentChange:R},null,8,["current-page","page-size","total"])])]),_:1}),e($,{modelValue:b.value,"onUpdate:modelValue":a[8]||(a[8]=o=>b.value=o),title:"日志详情",width:"700px"},{default:t(()=>[n.value?(x(),Z(X,{key:0,column:2,border:""},{default:t(()=>[e(p,{label:"日志ID"},{default:t(()=>[i(r(n.value.id),1)]),_:1}),e(p,{label:"日志类型"},{default:t(()=>[e(y,{type:N(n.value.logType)},{default:t(()=>[i(r(w(n.value.logType)),1)]),_:1},8,["type"])]),_:1}),e(p,{label:"操作类型"},{default:t(()=>[e(y,{type:V(n.value.actionType)},{default:t(()=>[i(r(E(n.value.actionType)),1)]),_:1},8,["type"])]),_:1}),e(p,{label:"用户"},{default:t(()=>[i(r(n.value.userName),1)]),_:1}),e(p,{label:"模块"},{default:t(()=>[i(r(n.value.module),1)]),_:1}),e(p,{label:"状态"},{default:t(()=>[e(y,{type:n.value.status==="success"?"success":"danger"},{default:t(()=>[i(r(n.value.status==="success"?"成功":"失败"),1)]),_:1},8,["type"])]),_:1}),e(p,{label:"操作描述",span:2},{default:t(()=>[i(r(n.value.description),1)]),_:1}),e(p,{label:"IP地址"},{default:t(()=>[i(r(n.value.ipAddress),1)]),_:1}),e(p,{label:"地理位置"},{default:t(()=>[i(r(n.value.location),1)]),_:1}),e(p,{label:"浏览器",span:2},{default:t(()=>[i(r(n.value.userAgent),1)]),_:1}),e(p,{label:"时间戳"},{default:t(()=>[i(r(n.value.timestamp),1)]),_:1}),e(p,{label:"请求耗时"},{default:t(()=>[i(r(n.value.duration)+"ms",1)]),_:1}),e(p,{label:"请求路径",span:2},{default:t(()=>[i(r(n.value.requestPath),1)]),_:1}),e(p,{label:"请求参数",span:2},{default:t(()=>[e(P,{modelValue:n.value.requestParams,"onUpdate:modelValue":a[7]||(a[7]=o=>n.value.requestParams=o),type:"textarea",rows:3,readonly:"",style:{"font-family":"monospace","font-size":"12px"}},null,8,["modelValue"])]),_:1})]),_:1})):ee("",!0)]),_:1},8,["modelValue"])])}}}),He=te(he,[["__scopeId","data-v-a398df84"]]);export{He as default};
