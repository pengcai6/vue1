import{d as oe,r as _,j as se,c as p,a as t,w as a,o as d,b as s,n,i as u,l as D,m as S,F as $,D as A,H as ne}from"./index-DAZDpghP.js";import{E as ue,a as ie}from"./timeline-item-D2GMA4fJ.js";import{E as me,a as de}from"./descriptions-item-DIjWwK7N.js";import{E as re}from"./dialog-CI4qXYgt.js";import{E as pe,a as ce}from"./form-item-D50nbGgb.js";import{E as fe}from"./input-BsUoEHjr.js";import{E as _e}from"./input-number-BUSsIkB9.js";/* empty css            */import{E as ge,a as ve}from"./select-B_Nc0zOl.js";import"./scrollbar-BKn1N4ug.js";import{E as ye,a as be}from"./col-1pbAQj7U.js";import{E as Te}from"./progress-CA3fGClE.js";import{a as Ne,E as Ce}from"./table-column-CkszfM6q.js";import"./checkbox-DDntw5na.js";import{E as Ee}from"./popover--wAAUrH1.js";import{E as ke}from"./button-CFFx6FdR.js";import{E as Ve}from"./card-_e8Y2itV.js";import{E as Ue}from"./index-i9SNigSW.js";import{E}from"./index-B4p_U5VT.js";import{_ as De}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./event-D5_Wo8Xc.js";import"./scroll-PXqKi88e.js";import"./index-17xiCnpu.js";import"./_baseClone-BBryStzM.js";import"./index-BBjiecLk.js";import"./strings-BN0-5NCg.js";import"./isEqual-DlB8YXyV.js";import"./debounce-Bv_84CHO.js";import"./_baseIteratee-DgY2c_zD.js";import"./isPlainObject-CnEW4LJ3.js";const Se={class:"intelligent-scheduling-page p-5"},Pe={class:"flex items-center justify-between"},Ge={key:0,class:"text-green-600"},he={key:1,class:"text-gray-400"},we={class:"node-list"},Ie=["onClick"],xe={class:"node-header"},Be={class:"font-bold"},Le={class:"node-info mt-2"},$e={class:"info-item"},Ae={class:"value"},Re={class:"info-item"},qe={class:"value"},Fe={class:"info-item"},Me={key:0,class:"text-green-600"},ze={key:1},Oe={key:1,class:"mt-4"},Je=oe({__name:"intelligent-scheduling",setup(He){const g=_([]),N=_([]),P=_(null),y=_(!1),k=_(!1),i=_(null),m=_({taskName:"",gpuType:"",gpuCount:1,memoryRequired:80,modelName:""});function R(){return[{id:"1",taskName:"llama2-7b-inference",gpuType:"NVIDIA A100",gpuCount:2,memoryRequired:80,modelName:"Llama-2-7B",status:"scheduled",matchedNode:"gpu-node-01",createTime:"2024-01-15 10:30:00",scheduleLog:[{time:"10:30:00",message:"任务创建成功",type:"success"},{time:"10:30:05",message:"开始匹配节点...",type:"info"},{time:"10:30:08",message:"找到匹配节点: gpu-node-01",type:"success"},{time:"10:30:10",message:"节点绑定成功",type:"success"}]},{id:"2",taskName:"chatglm-6b-inference",gpuType:"昇腾 910B",gpuCount:1,memoryRequired:64,modelName:"ChatGLM-6B",status:"pending",createTime:"2024-01-15 11:00:00"}]}function G(o){return{pending:"info",scheduled:"success",running:"warning",failed:"danger"}[o]||"info"}function h(o){return{pending:"等待调度",scheduled:"已调度",running:"运行中",failed:"调度失败"}[o]||o}function q(o){return o.includes("NVIDIA")?"success":o.includes("昇腾")?"warning":"info"}function F(o){return o<30?"#67C23A":o<70?"#E6A23C":"#F56C6C"}function M(o){P.value=o}function z(){const o={id:Date.now().toString(),...m.value,status:"pending",createTime:new Date().toLocaleString("zh-CN")};g.value.unshift(o),C(),y.value=!1,E.success("任务创建成功"),m.value={taskName:"",gpuType:"",gpuCount:1,memoryRequired:80,modelName:""}}function O(o){const e=J(o);e?(o.status="scheduled",o.matchedNode=e.nodeName,o.scheduleLog=[{time:new Date().toLocaleTimeString(),message:"开始调度任务",type:"info"},{time:new Date().toLocaleTimeString(),message:`匹配条件: GPU类型=${o.gpuType}, 数量=${o.gpuCount}, 显存=${o.memoryRequired}GB`,type:"info"},{time:new Date().toLocaleTimeString(),message:`找到匹配节点: ${e.nodeName}`,type:"success"},{time:new Date().toLocaleTimeString(),message:`节点资源: GPU=${e.gpuType}, 可用=${e.availableGPUs}卡, 单卡显存=${e.memoryPerGPU}GB`,type:"success"},{time:new Date().toLocaleTimeString(),message:"调度成功，容器已绑定到节点",type:"success"}],e.availableGPUs-=o.gpuCount,localStorage.setItem("gpu-nodes",JSON.stringify(N.value)),C(),E.success(`调度成功！已绑定到节点: ${e.nodeName}`)):(o.status="failed",o.scheduleLog=[{time:new Date().toLocaleTimeString(),message:"开始调度任务",type:"info"},{time:new Date().toLocaleTimeString(),message:"未找到满足条件的节点",type:"danger"},{time:new Date().toLocaleTimeString(),message:"调度失败",type:"danger"}],C(),E.error("调度失败：未找到满足条件的节点"))}function J(o){return N.value.find(e=>e.status==="online"&&e.gpuType===o.gpuType&&e.availableGPUs>=o.gpuCount&&e.memoryPerGPU>=o.memoryRequired)||null}function H(o){i.value=o,k.value=!0}function j(o){g.value=g.value.filter(e=>e.id!==o),C(),E.success("删除成功")}function C(){localStorage.setItem("schedule-tasks",JSON.stringify(g.value))}function K(){const o=localStorage.getItem("schedule-tasks");g.value=o?JSON.parse(o):R();const e=localStorage.getItem("gpu-nodes");N.value=e?JSON.parse(e):[]}return se(()=>{K()}),(o,e)=>{const V=Ve,v=ke,b=Ce,U=Ue,Q=Ee,W=Ne,w=be,X=Te,Y=ye,I=fe,T=ce,f=ve,Z=ge,x=_e,ee=pe,B=re,c=me,te=de,le=ie,ae=ue;return d(),p("div",Se,[t(V,{class:"header-card"},{default:a(()=>e[9]||(e[9]=[s("h2",{class:"text-2xl font-bold mb-2"},"大模型推理智能调度",-1),s("p",{class:"text-gray-500"}," 根据推理容器对加速器类型、数量及显存的需求，进行精确的节点匹配与绑定 ",-1)])),_:1,__:[9]}),t(Y,{gutter:20,class:"mt-4"},{default:a(()=>[t(w,{span:14},{default:a(()=>[t(V,null,{header:a(()=>[s("div",Pe,[e[11]||(e[11]=s("span",{class:"font-bold"},"调度任务列表",-1)),t(v,{type:"primary",onClick:e[0]||(e[0]=l=>y.value=!0)},{default:a(()=>e[10]||(e[10]=[u(" 创建调度任务 ",-1)])),_:1,__:[10]})])]),default:a(()=>[t(W,{data:g.value,stripe:""},{default:a(()=>[t(b,{prop:"taskName",label:"任务名称",width:"150"}),t(b,{label:"GPU需求",width:"200"},{default:a(({row:l})=>[s("div",null,[s("div",null,"类型: "+n(l.gpuType),1),s("div",null,"数量: "+n(l.gpuCount)+" 卡",1),s("div",null,"显存: "+n(l.memoryRequired)+" GB",1)])]),_:1}),t(b,{label:"调度状态",width:"120",align:"center"},{default:a(({row:l})=>[t(U,{type:G(l.status)},{default:a(()=>[u(n(h(l.status)),1)]),_:2},1032,["type"])]),_:1}),t(b,{prop:"matchedNode",label:"匹配节点",width:"150"},{default:a(({row:l})=>[l.matchedNode?(d(),p("span",Ge,n(l.matchedNode),1)):(d(),p("span",he,"等待调度"))]),_:1}),t(b,{label:"操作",width:"180",fixed:"right"},{default:a(({row:l})=>[l.status==="pending"?(d(),D(v,{key:0,link:"",type:"primary",onClick:r=>O(l)},{default:a(()=>e[12]||(e[12]=[u(" 执行调度 ",-1)])),_:2,__:[12]},1032,["onClick"])):S("",!0),t(v,{link:"",type:"info",onClick:r=>H(l)},{default:a(()=>e[13]||(e[13]=[u(" 详情 ",-1)])),_:2,__:[13]},1032,["onClick"]),t(Q,{title:"确定要删除此任务吗？",onConfirm:r=>j(l.id)},{reference:a(()=>[t(v,{link:"",type:"danger"},{default:a(()=>e[14]||(e[14]=[u(" 删除 ",-1)])),_:1,__:[14]})]),_:2},1032,["onConfirm"])]),_:1})]),_:1},8,["data"])]),_:1})]),_:1}),t(w,{span:10},{default:a(()=>[t(V,null,{header:a(()=>e[15]||(e[15]=[s("span",{class:"font-bold"},"可用GPU节点",-1)])),default:a(()=>[s("div",we,[(d(!0),p($,null,A(N.value,l=>{var r;return d(),p("div",{key:l.id,class:ne(["node-item",{"node-selected":((r=P.value)==null?void 0:r.id)===l.id}]),onClick:L=>M(l)},[s("div",xe,[s("span",Be,n(l.nodeName),1),t(U,{size:"small",type:q(l.gpuType)},{default:a(()=>[u(n(l.gpuType),1)]),_:2},1032,["type"])]),s("div",Le,[s("div",$e,[e[16]||(e[16]=s("span",{class:"label"},"可用GPU:",-1)),s("span",Ae,n(l.availableGPUs)+"/"+n(l.gpuCount),1)]),s("div",Re,[e[17]||(e[17]=s("span",{class:"label"},"单卡显存:",-1)),s("span",qe,n(l.memoryPerGPU)+" GB",1)]),s("div",Fe,[e[18]||(e[18]=s("span",{class:"label"},"利用率:",-1)),t(X,{percentage:l.utilization,color:F(l.utilization)},null,8,["percentage","color"])])])],10,Ie)}),128))])]),_:1})]),_:1})]),_:1}),t(B,{modelValue:y.value,"onUpdate:modelValue":e[7]||(e[7]=l=>y.value=l),title:"创建调度任务",width:"600px"},{footer:a(()=>[t(v,{onClick:e[6]||(e[6]=l=>y.value=!1)},{default:a(()=>e[19]||(e[19]=[u("取消",-1)])),_:1,__:[19]}),t(v,{type:"primary",onClick:z},{default:a(()=>e[20]||(e[20]=[u("创建",-1)])),_:1,__:[20]})]),default:a(()=>[t(ee,{model:m.value,"label-width":"120px"},{default:a(()=>[t(T,{label:"任务名称"},{default:a(()=>[t(I,{modelValue:m.value.taskName,"onUpdate:modelValue":e[1]||(e[1]=l=>m.value.taskName=l),placeholder:"请输入任务名称"},null,8,["modelValue"])]),_:1}),t(T,{label:"GPU类型"},{default:a(()=>[t(Z,{modelValue:m.value.gpuType,"onUpdate:modelValue":e[2]||(e[2]=l=>m.value.gpuType=l),placeholder:"请选择GPU类型",style:{width:"100%"}},{default:a(()=>[t(f,{label:"NVIDIA A100",value:"NVIDIA A100"}),t(f,{label:"NVIDIA H100",value:"NVIDIA H100"}),t(f,{label:"昇腾 910B",value:"昇腾 910B"}),t(f,{label:"沐曦 C500",value:"沐曦 C500"}),t(f,{label:"海光 DCU",value:"海光 DCU"}),t(f,{label:"摩尔线程 MTT S80",value:"摩尔线程 MTT S80"}),t(f,{label:"阿里 PPU",value:"阿里 PPU"})]),_:1},8,["modelValue"])]),_:1}),t(T,{label:"GPU数量"},{default:a(()=>[t(x,{modelValue:m.value.gpuCount,"onUpdate:modelValue":e[3]||(e[3]=l=>m.value.gpuCount=l),min:1,max:8},null,8,["modelValue"])]),_:1}),t(T,{label:"显存需求(GB)"},{default:a(()=>[t(x,{modelValue:m.value.memoryRequired,"onUpdate:modelValue":e[4]||(e[4]=l=>m.value.memoryRequired=l),min:16,max:80,step:8},null,8,["modelValue"])]),_:1}),t(T,{label:"模型名称"},{default:a(()=>[t(I,{modelValue:m.value.modelName,"onUpdate:modelValue":e[5]||(e[5]=l=>m.value.modelName=l),placeholder:"请输入模型名称"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),t(B,{modelValue:k.value,"onUpdate:modelValue":e[8]||(e[8]=l=>k.value=l),title:"调度任务详情",width:"700px"},{default:a(()=>{var l;return[i.value?(d(),D(te,{key:0,column:2,border:""},{default:a(()=>[t(c,{label:"任务名称"},{default:a(()=>[u(n(i.value.taskName),1)]),_:1}),t(c,{label:"模型名称"},{default:a(()=>[u(n(i.value.modelName),1)]),_:1}),t(c,{label:"GPU类型"},{default:a(()=>[u(n(i.value.gpuType),1)]),_:1}),t(c,{label:"GPU数量"},{default:a(()=>[u(n(i.value.gpuCount)+" 卡 ",1)]),_:1}),t(c,{label:"显存需求"},{default:a(()=>[u(n(i.value.memoryRequired)+" GB ",1)]),_:1}),t(c,{label:"匹配节点"},{default:a(()=>[i.value.matchedNode?(d(),p("span",Me,n(i.value.matchedNode),1)):(d(),p("span",ze,"-"))]),_:1}),t(c,{label:"调度状态"},{default:a(()=>[t(U,{type:G(i.value.status)},{default:a(()=>[u(n(h(i.value.status)),1)]),_:1},8,["type"])]),_:1}),t(c,{label:"创建时间"},{default:a(()=>[u(n(i.value.createTime),1)]),_:1})]),_:1})):S("",!0),(l=i.value)!=null&&l.scheduleLog?(d(),p("div",Oe,[e[21]||(e[21]=s("h3",{class:"font-bold mb-2"},"调度日志",-1)),t(ae,null,{default:a(()=>[(d(!0),p($,null,A(i.value.scheduleLog,(r,L)=>(d(),D(le,{key:L,timestamp:r.time,placement:"top",type:r.type},{default:a(()=>[u(n(r.message),1)]),_:2},1032,["timestamp","type"]))),128))]),_:1})])):S("",!0)]}),_:1},8,["modelValue"])])}}}),Et=De(Je,[["__scopeId","data-v-1f4e5808"]]);export{Et as default};
