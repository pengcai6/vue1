import{d as pe,r as d,B as U,j as me,c as N,a,w as t,o as I,b as k,i,n as x,E as ce,e as ge,aN as ve,F as A,D as R,l as S}from"./index-DAZDpghP.js";import{E as ye}from"./dialog-CI4qXYgt.js";import{E as fe,a as _e}from"./radio-ChFPTsFt.js";import{E as Te}from"./card-_e8Y2itV.js";import{E as be}from"./pagination-BBEphupa.js";/* empty css            */import{E as Ie,a as Ve}from"./select-B_Nc0zOl.js";import"./scrollbar-BKn1N4ug.js";import"./input-BsUoEHjr.js";import{a as we,E as Ee}from"./table-column-CkszfM6q.js";import"./checkbox-DDntw5na.js";import{E as Ce,a as Ne}from"./form-item-D50nbGgb.js";import{E as ke}from"./button-CFFx6FdR.js";import{E as xe}from"./index-i9SNigSW.js";import{E as Be}from"./index-TLwRQi5N.js";import{E as B}from"./index-B4p_U5VT.js";import{_ as he}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./event-D5_Wo8Xc.js";import"./scroll-PXqKi88e.js";import"./index-17xiCnpu.js";import"./isEqual-DlB8YXyV.js";import"./strings-BN0-5NCg.js";import"./debounce-Bv_84CHO.js";import"./_baseIteratee-DgY2c_zD.js";import"./isPlainObject-CnEW4LJ3.js";import"./_baseClone-BBryStzM.js";import"./validator-BGx-pjuX.js";const ze={class:"resource-permission-page"},De={class:"card-header"},Pe={class:"pagination"},Ue=pe({__name:"resource-permission",setup(Ae){const s=d({resourceType:"",granteeType:"",permission:""}),g=d([]),v=d(1),_=d(10),f=d(!1),V=d("create"),w=d(),o=d({id:"",resourceType:"",resourceId:"",granteeType:"",granteeId:"",permission:"read-only"}),G={resourceType:[{required:!0,message:"请选择资源类型",trigger:"change"}],resourceId:[{required:!0,message:"请选择资源",trigger:"change"}],granteeType:[{required:!0,message:"请选择授权对象类型",trigger:"change"}],granteeId:[{required:!0,message:"请选择授权对象",trigger:"change"}],permission:[{required:!0,message:"请选择权限级别",trigger:"change"}]},T=d([]),b=d([]),h={model:[{id:"model-001",name:"Qwen2.5-72B-Instruct"},{id:"model-002",name:"DeepSeek-V3"},{id:"model-003",name:"GLM-4-Plus"}],dataset:[{id:"dataset-001",name:"客服对话数据集"},{id:"dataset-002",name:"金融问答数据集"},{id:"dataset-003",name:"医疗诊断数据集"}],gpu:[{id:"gpu-pool-001",name:"NVIDIA A100 资源池"},{id:"gpu-pool-002",name:"昇腾910B 资源池"},{id:"gpu-pool-003",name:"沐曦C500 资源池"}],service:[{id:"service-001",name:"qwen-chat-api"},{id:"service-002",name:"deepseek-inference"},{id:"service-003",name:"glm-service"}]},z={user:[{id:"user-001",name:"张三"},{id:"user-002",name:"李四"},{id:"user-003",name:"王五"}],role:[{id:"role-developer",name:"开发者"},{id:"role-operator",name:"运维人员"},{id:"role-viewer",name:"访客"}],organization:[{id:"org-001",name:"技术研发部"},{id:"org-002",name:"产品部"},{id:"org-003",name:"AI实验室"}]},q=()=>{const r=[{id:"perm-001",resourceType:"model",resourceId:"model-001",resourceName:"Qwen2.5-72B-Instruct",granteeType:"user",granteeId:"user-001",granteeName:"张三",permission:"owner",createdBy:"管理员",createdAt:"2024-01-15 10:00:00"},{id:"perm-002",resourceType:"dataset",resourceId:"dataset-001",resourceName:"客服对话数据集",granteeType:"role",granteeId:"role-developer",granteeName:"开发者",permission:"read-write",createdBy:"管理员",createdAt:"2024-02-10 14:30:00"},{id:"perm-003",resourceType:"gpu",resourceId:"gpu-pool-001",resourceName:"NVIDIA A100 资源池",granteeType:"organization",granteeId:"org-001",granteeName:"技术研发部",permission:"read-write",createdBy:"管理员",createdAt:"2024-03-05 09:20:00"},{id:"perm-004",resourceType:"service",resourceId:"service-001",resourceName:"qwen-chat-api",granteeType:"role",granteeId:"role-viewer",granteeName:"访客",permission:"read-only",createdBy:"管理员",createdAt:"2024-04-12 16:45:00"},{id:"perm-005",resourceType:"model",resourceId:"model-002",resourceName:"DeepSeek-V3",granteeType:"user",granteeId:"user-002",granteeName:"李四",permission:"read-write",createdBy:"管理员",createdAt:"2024-05-08 11:15:00"}];g.value=r},F=()=>{q()},D=U(()=>{let r=g.value;return s.value.resourceType&&(r=r.filter(e=>e.resourceType===s.value.resourceType)),s.value.granteeType&&(r=r.filter(e=>e.granteeType===s.value.granteeType)),s.value.permission&&(r=r.filter(e=>e.permission===s.value.permission)),r}),M=U(()=>{const r=(v.value-1)*_.value,e=r+_.value;return D.value.slice(r,e)}),$=()=>{v.value=1},L=()=>{s.value={resourceType:"",granteeType:"",permission:""},v.value=1},j=()=>{V.value="create",f.value=!0},Q=r=>{V.value="edit",o.value={id:r.id,resourceType:r.resourceType,resourceId:r.resourceId,granteeType:r.granteeType,granteeId:r.granteeId,permission:r.permission},T.value=h[r.resourceType]||[],b.value=z[r.granteeType]||[],f.value=!0},O=r=>{Be.confirm("确定要删除该权限规则吗? 此操作不可恢复。","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"error"}).then(()=>{const e=g.value.findIndex(u=>u.id===r.id);e>-1&&(g.value.splice(e,1),B.success("删除成功"))})},H=async()=>{await w.value.validate();const r=T.value.find(u=>u.id===o.value.resourceId),e=b.value.find(u=>u.id===o.value.granteeId);if(V.value==="create"){const u={id:`perm-${Date.now()}`,resourceType:o.value.resourceType,resourceId:o.value.resourceId,resourceName:(r==null?void 0:r.name)||"",granteeType:o.value.granteeType,granteeId:o.value.granteeId,granteeName:(e==null?void 0:e.name)||"",permission:o.value.permission,createdBy:"管理员",createdAt:new Date().toLocaleString("zh-CN")};g.value.unshift(u),B.success("创建成功")}else{const u=g.value.findIndex(p=>p.id===o.value.id);u>-1&&(g.value[u]={...g.value[u],resourceType:o.value.resourceType,resourceId:o.value.resourceId,resourceName:(r==null?void 0:r.name)||"",granteeType:o.value.granteeType,granteeId:o.value.granteeId,granteeName:(e==null?void 0:e.name)||"",permission:o.value.permission},B.success("更新成功"))}f.value=!1},J=()=>{var r;(r=w.value)==null||r.resetFields(),o.value={id:"",resourceType:"",resourceId:"",granteeType:"",granteeId:"",permission:"read-only"},T.value=[],b.value=[]},K=r=>{o.value.resourceId="",T.value=h[r]||[]},W=r=>{o.value.granteeId="",b.value=z[r]||[]},X=r=>({model:"模型",dataset:"数据集",gpu:"GPU资源",service:"部署服务"})[r]||r,Y=r=>({model:"primary",dataset:"success",gpu:"warning",service:"danger"})[r]||"",Z=r=>({user:"用户",role:"角色",organization:"组织"})[r]||r,ee=r=>({user:"primary",role:"success",organization:"warning"})[r]||"",ae=r=>({owner:"所有者","read-write":"读写","read-only":"只读"})[r]||r,re=r=>({owner:"danger","read-write":"warning","read-only":"info"})[r]||"",le=r=>{_.value=r,v.value=1},te=r=>{v.value=r};return me(()=>{F()}),(r,e)=>{const u=ce,p=ke,n=Ve,y=Ie,m=Ne,P=Ce,c=Ee,E=xe,oe=we,ne=be,se=Te,C=_e,ue=fe,ie=ye;return I(),N("div",ze,[a(se,null,{header:t(()=>[k("div",De,[e[13]||(e[13]=k("span",{class:"title"},"资源权限管控",-1)),a(p,{type:"primary",onClick:j},{default:t(()=>[a(u,null,{default:t(()=>[a(ge(ve))]),_:1}),e[12]||(e[12]=i(" 添加权限规则 ",-1))]),_:1,__:[12]})])]),default:t(()=>[a(P,{inline:!0,class:"search-form"},{default:t(()=>[a(m,{label:"资源类型"},{default:t(()=>[a(y,{modelValue:s.value.resourceType,"onUpdate:modelValue":e[0]||(e[0]=l=>s.value.resourceType=l),placeholder:"请选择资源类型",clearable:"",style:{width:"150px"}},{default:t(()=>[a(n,{label:"全部",value:""}),a(n,{label:"模型",value:"model"}),a(n,{label:"数据集",value:"dataset"}),a(n,{label:"GPU资源",value:"gpu"}),a(n,{label:"部署服务",value:"service"})]),_:1},8,["modelValue"])]),_:1}),a(m,{label:"授权对象"},{default:t(()=>[a(y,{modelValue:s.value.granteeType,"onUpdate:modelValue":e[1]||(e[1]=l=>s.value.granteeType=l),placeholder:"请选择授权对象",clearable:"",style:{width:"150px"}},{default:t(()=>[a(n,{label:"全部",value:""}),a(n,{label:"用户",value:"user"}),a(n,{label:"角色",value:"role"}),a(n,{label:"组织",value:"organization"})]),_:1},8,["modelValue"])]),_:1}),a(m,{label:"权限级别"},{default:t(()=>[a(y,{modelValue:s.value.permission,"onUpdate:modelValue":e[2]||(e[2]=l=>s.value.permission=l),placeholder:"请选择权限级别",clearable:"",style:{width:"150px"}},{default:t(()=>[a(n,{label:"全部",value:""}),a(n,{label:"所有者",value:"owner"}),a(n,{label:"读写",value:"read-write"}),a(n,{label:"只读",value:"read-only"})]),_:1},8,["modelValue"])]),_:1}),a(m,null,{default:t(()=>[a(p,{type:"primary",onClick:$},{default:t(()=>e[14]||(e[14]=[i("查询",-1)])),_:1,__:[14]}),a(p,{onClick:L},{default:t(()=>e[15]||(e[15]=[i("重置",-1)])),_:1,__:[15]})]),_:1})]),_:1}),a(oe,{data:M.value,border:"",style:{width:"100%"}},{default:t(()=>[a(c,{prop:"id",label:"规则ID",width:"140"}),a(c,{prop:"resourceType",label:"资源类型",width:"120"},{default:t(({row:l})=>[a(E,{type:Y(l.resourceType)},{default:t(()=>[i(x(X(l.resourceType)),1)]),_:2},1032,["type"])]),_:1}),a(c,{prop:"resourceName",label:"资源名称",width:"200","show-overflow-tooltip":""}),a(c,{prop:"granteeType",label:"授权对象类型",width:"120",align:"center"},{default:t(({row:l})=>[a(E,{type:ee(l.granteeType)},{default:t(()=>[i(x(Z(l.granteeType)),1)]),_:2},1032,["type"])]),_:1}),a(c,{prop:"granteeName",label:"授权对象",width:"150"}),a(c,{prop:"permission",label:"权限级别",width:"120",align:"center"},{default:t(({row:l})=>[a(E,{type:re(l.permission)},{default:t(()=>[i(x(ae(l.permission)),1)]),_:2},1032,["type"])]),_:1}),a(c,{prop:"createdBy",label:"创建人",width:"100"}),a(c,{prop:"createdAt",label:"创建时间",width:"180"}),a(c,{label:"操作",width:"150",fixed:"right"},{default:t(({row:l})=>[a(p,{link:"",type:"primary",size:"small",onClick:de=>Q(l)},{default:t(()=>e[16]||(e[16]=[i("编辑",-1)])),_:2,__:[16]},1032,["onClick"]),a(p,{link:"",type:"danger",size:"small",onClick:de=>O(l)},{default:t(()=>e[17]||(e[17]=[i("删除",-1)])),_:2,__:[17]},1032,["onClick"])]),_:1})]),_:1},8,["data"]),k("div",Pe,[a(ne,{"current-page":v.value,"onUpdate:currentPage":e[3]||(e[3]=l=>v.value=l),"page-size":_.value,"onUpdate:pageSize":e[4]||(e[4]=l=>_.value=l),"page-sizes":[10,20,50,100],total:D.value.length,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:le,onCurrentChange:te},null,8,["current-page","page-size","total"])])]),_:1}),a(ie,{modelValue:f.value,"onUpdate:modelValue":e[11]||(e[11]=l=>f.value=l),title:V.value==="create"?"添加权限规则":"编辑权限规则",width:"600px",onClose:J},{footer:t(()=>[a(p,{onClick:e[10]||(e[10]=l=>f.value=!1)},{default:t(()=>e[21]||(e[21]=[i("取消",-1)])),_:1,__:[21]}),a(p,{type:"primary",onClick:H},{default:t(()=>e[22]||(e[22]=[i("确定",-1)])),_:1,__:[22]})]),default:t(()=>[a(P,{model:o.value,rules:G,ref_key:"formRef",ref:w,"label-width":"120px"},{default:t(()=>[a(m,{label:"资源类型",prop:"resourceType"},{default:t(()=>[a(y,{modelValue:o.value.resourceType,"onUpdate:modelValue":e[5]||(e[5]=l=>o.value.resourceType=l),placeholder:"请选择资源类型",onChange:K},{default:t(()=>[a(n,{label:"模型",value:"model"}),a(n,{label:"数据集",value:"dataset"}),a(n,{label:"GPU资源",value:"gpu"}),a(n,{label:"部署服务",value:"service"})]),_:1},8,["modelValue"])]),_:1}),a(m,{label:"资源",prop:"resourceId"},{default:t(()=>[a(y,{modelValue:o.value.resourceId,"onUpdate:modelValue":e[6]||(e[6]=l=>o.value.resourceId=l),placeholder:"请选择资源",filterable:""},{default:t(()=>[(I(!0),N(A,null,R(T.value,l=>(I(),S(n,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(m,{label:"授权对象类型",prop:"granteeType"},{default:t(()=>[a(y,{modelValue:o.value.granteeType,"onUpdate:modelValue":e[7]||(e[7]=l=>o.value.granteeType=l),placeholder:"请选择授权对象类型",onChange:W},{default:t(()=>[a(n,{label:"用户",value:"user"}),a(n,{label:"角色",value:"role"}),a(n,{label:"组织",value:"organization"})]),_:1},8,["modelValue"])]),_:1}),a(m,{label:"授权对象",prop:"granteeId"},{default:t(()=>[a(y,{modelValue:o.value.granteeId,"onUpdate:modelValue":e[8]||(e[8]=l=>o.value.granteeId=l),placeholder:"请选择授权对象",filterable:""},{default:t(()=>[(I(!0),N(A,null,R(b.value,l=>(I(),S(n,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(m,{label:"权限级别",prop:"permission"},{default:t(()=>[a(ue,{modelValue:o.value.permission,"onUpdate:modelValue":e[9]||(e[9]=l=>o.value.permission=l)},{default:t(()=>[a(C,{label:"owner"},{default:t(()=>e[18]||(e[18]=[i("所有者（读写删除）",-1)])),_:1,__:[18]}),a(C,{label:"read-write"},{default:t(()=>e[19]||(e[19]=[i("读写",-1)])),_:1,__:[19]}),a(C,{label:"read-only"},{default:t(()=>e[20]||(e[20]=[i("只读",-1)])),_:1,__:[20]})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}}),ia=he(Ue,[["__scopeId","data-v-85d6cd65"]]);export{ia as default};
