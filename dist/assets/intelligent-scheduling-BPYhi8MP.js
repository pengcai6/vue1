import{d as se,r as _,h as ne,b as r,o as d,f as t,w as a,e as s,t as n,a as u,c as D,j as P,F as L,A as $,D as ue,_ as ie}from"./index-C1LNxWrc.js";import{E as me,a as de}from"./timeline-item-p9HOzw6X.js";import{E as re,a as pe}from"./descriptions-item-BClrjkTE.js";import{E as ce}from"./dialog-D1_iS1Vq.js";import{E as _e,a as fe}from"./form-item-BZC8dQDK.js";import{E as ge}from"./input-LGwqt1-Y.js";import{E as ve}from"./input-number-BdlakYFh.js";/* empty css            */import{E as ye,a as be}from"./select-BSsX693L.js";import"./scrollbar-CWDB5A-B.js";import{E as Te,a as Ne}from"./col-BHj47XkZ.js";import{E as Ce}from"./progress-D7FpNBk1.js";import{E as Ee,a as ke}from"./table-column-QOtjyKSd.js";import"./checkbox-D429Hkk4.js";import{E as Ve}from"./popover-DP0DHMQv.js";import{E as Ue}from"./button-CfgjJGa2.js";import{E as De}from"./card-bOHwtd_N.js";import{s as A,g as R}from"./storage-2nKQMLp0.js";import{E as Pe}from"./index-gsKI2Iim.js";import{E}from"./index-JFsgmBjq.js";import"./use-form-common-props-dMO5F-Xy.js";import"./index-DaWWsILK.js";import"./scroll-RLo4NxSV.js";import"./index-DRLRXOGd.js";import"./_initCloneObject-T9RaIEd1.js";import"./_baseClone-0EgoVDGI.js";import"./index-BPEUnmM4.js";import"./index-BYwYey8Q.js";import"./strings-BOPxCUMK.js";import"./isEqual-CFwnnDW_.js";import"./debounce-C4p0xsPh.js";import"./_baseIteratee-CNffayvf.js";import"./isPlainObject-BS8VhLgB.js";const he={class:"intelligent-scheduling-page"},Ge={class:"flex items-center justify-between"},we={key:0,class:"text-green-600"},Se={key:1,class:"text-gray-400"},xe={class:"node-list"},Ie=["onClick"],Be={class:"node-header"},Le={class:"font-bold"},$e={class:"node-info mt-2"},Ae={class:"info-item"},Re={class:"value"},qe={class:"info-item"},Fe={class:"value"},Me={class:"info-item"},ze={key:0,class:"text-green-600"},je={key:1},He={key:1,class:"mt-4"},Oe=se({__name:"intelligent-scheduling",setup(Je){const f=_([]),N=_([]),h=_(null),v=_(!1),k=_(!1),i=_(null),m=_({taskName:"",gpuType:"",gpuCount:1,memoryRequired:80,modelName:""});function q(){return[{id:"1",taskName:"llama2-7b-inference",gpuType:"NVIDIA A100",gpuCount:2,memoryRequired:80,modelName:"Llama-2-7B",status:"scheduled",matchedNode:"gpu-node-01",createTime:"2024-01-15 10:30:00",scheduleLog:[{time:"10:30:00",message:"任务创建成功",type:"success"},{time:"10:30:05",message:"开始匹配节点...",type:"info"},{time:"10:30:08",message:"找到匹配节点: gpu-node-01",type:"success"},{time:"10:30:10",message:"节点绑定成功",type:"success"}]},{id:"2",taskName:"chatglm-6b-inference",gpuType:"昇腾 910B",gpuCount:1,memoryRequired:64,modelName:"ChatGLM-6B",status:"pending",createTime:"2024-01-15 11:00:00"}]}function G(o){return{pending:"info",scheduled:"success",running:"warning",failed:"danger"}[o]||"info"}function w(o){return{pending:"等待调度",scheduled:"已调度",running:"运行中",failed:"调度失败"}[o]||o}function F(o){return o.includes("NVIDIA")?"success":o.includes("昇腾")?"warning":"info"}function M(o){return o<30?"#67C23A":o<70?"#E6A23C":"#F56C6C"}function z(o){h.value=o}function j(){const o={id:Date.now().toString(),...m.value,status:"pending",createTime:new Date().toLocaleString("zh-CN")};f.value.unshift(o),C(),v.value=!1,E.success("任务创建成功"),m.value={taskName:"",gpuType:"",gpuCount:1,memoryRequired:80,modelName:""}}function H(o){const e=O(o);e?(o.status="scheduled",o.matchedNode=e.nodeName,o.scheduleLog=[{time:new Date().toLocaleTimeString(),message:"开始调度任务",type:"info"},{time:new Date().toLocaleTimeString(),message:`匹配条件: GPU类型=${o.gpuType}, 数量=${o.gpuCount}, 显存=${o.memoryRequired}GB`,type:"info"},{time:new Date().toLocaleTimeString(),message:`找到匹配节点: ${e.nodeName}`,type:"success"},{time:new Date().toLocaleTimeString(),message:`节点资源: GPU=${e.gpuType}, 可用=${e.availableGPUs}卡, 单卡显存=${e.memoryPerGPU}GB`,type:"success"},{time:new Date().toLocaleTimeString(),message:"调度成功，容器已绑定到节点",type:"success"}],e.availableGPUs-=o.gpuCount,A("gpu-nodes",N.value),C(),E.success(`调度成功！已绑定到节点: ${e.nodeName}`)):(o.status="failed",o.scheduleLog=[{time:new Date().toLocaleTimeString(),message:"开始调度任务",type:"info"},{time:new Date().toLocaleTimeString(),message:"未找到满足条件的节点",type:"danger"},{time:new Date().toLocaleTimeString(),message:"调度失败",type:"danger"}],C(),E.error("调度失败：未找到满足条件的节点"))}function O(o){return N.value.find(e=>e.status==="online"&&e.gpuType===o.gpuType&&e.availableGPUs>=o.gpuCount&&e.memoryPerGPU>=o.memoryRequired)||null}function J(o){i.value=o,k.value=!0}function K(o){f.value=f.value.filter(e=>e.id!==o),C(),E.success("删除成功")}function C(){A("schedule-tasks",f.value)}function Q(){const o=R("schedule-tasks",[]);f.value=o.length>0?o:q(),N.value=R("gpu-nodes",[])}return ne(()=>{Q()}),(o,e)=>{const V=De,g=Ue,y=ke,U=Pe,W=Ve,X=Ee,S=Te,Y=Ce,Z=Ne,x=ge,b=fe,c=be,ee=ye,I=ve,te=_e,B=ce,p=pe,le=re,ae=de,oe=me;return d(),r("div",he,[t(V,{class:"header-card"},{default:a(()=>e[9]||(e[9]=[s("h2",{class:"text-2xl font-bold mb-2"}," 大模型推理智能调度 ",-1),s("p",{class:"text-gray-500"}," 根据推理容器对加速器类型、数量及显存的需求，进行精确的节点匹配与绑定 ",-1)])),_:1,__:[9]}),t(Z,{gutter:20,class:"mt-4"},{default:a(()=>[t(S,{span:14},{default:a(()=>[t(V,null,{header:a(()=>[s("div",Ge,[e[11]||(e[11]=s("span",{class:"font-bold"},"调度任务列表",-1)),t(g,{type:"primary",onClick:e[0]||(e[0]=l=>v.value=!0)},{default:a(()=>e[10]||(e[10]=[u(" 创建调度任务 ",-1)])),_:1,__:[10]})])]),default:a(()=>[t(X,{data:f.value,stripe:""},{default:a(()=>[t(y,{prop:"taskName",label:"任务名称",width:"150"}),t(y,{label:"GPU需求",width:"200"},{default:a(({row:l})=>[s("div",null,[s("div",null,"类型: "+n(l.gpuType),1),s("div",null,"数量: "+n(l.gpuCount)+" 卡",1),s("div",null,"显存: "+n(l.memoryRequired)+" GB",1)])]),_:1}),t(y,{label:"调度状态",width:"120",align:"center"},{default:a(({row:l})=>[t(U,{type:G(l.status)},{default:a(()=>[u(n(w(l.status)),1)]),_:2},1032,["type"])]),_:1}),t(y,{prop:"matchedNode",label:"匹配节点",width:"150"},{default:a(({row:l})=>[l.matchedNode?(d(),r("span",we,n(l.matchedNode),1)):(d(),r("span",Se,"等待调度"))]),_:1}),t(y,{label:"操作",width:"180",fixed:"right"},{default:a(({row:l})=>[l.status==="pending"?(d(),D(g,{key:0,link:"",type:"primary",onClick:T=>H(l)},{default:a(()=>e[12]||(e[12]=[u(" 执行调度 ",-1)])),_:2,__:[12]},1032,["onClick"])):P("",!0),t(g,{link:"",type:"info",onClick:T=>J(l)},{default:a(()=>e[13]||(e[13]=[u(" 详情 ",-1)])),_:2,__:[13]},1032,["onClick"]),t(W,{title:"确定要删除此任务吗？",onConfirm:T=>K(l.id)},{reference:a(()=>[t(g,{link:"",type:"danger"},{default:a(()=>e[14]||(e[14]=[u(" 删除 ",-1)])),_:1,__:[14]})]),_:2},1032,["onConfirm"])]),_:1})]),_:1},8,["data"])]),_:1})]),_:1}),t(S,{span:10},{default:a(()=>[t(V,null,{header:a(()=>e[15]||(e[15]=[s("span",{class:"font-bold"},"可用GPU节点",-1)])),default:a(()=>[s("div",xe,[(d(!0),r(L,null,$(N.value,l=>(d(),r("div",{key:l.id,class:ue(["node-item",{"node-selected":h.value?.id===l.id}]),onClick:T=>z(l)},[s("div",Be,[s("span",Le,n(l.nodeName),1),t(U,{size:"small",type:F(l.gpuType)},{default:a(()=>[u(n(l.gpuType),1)]),_:2},1032,["type"])]),s("div",$e,[s("div",Ae,[e[16]||(e[16]=s("span",{class:"label"},"可用GPU:",-1)),s("span",Re,n(l.availableGPUs)+"/"+n(l.gpuCount),1)]),s("div",qe,[e[17]||(e[17]=s("span",{class:"label"},"单卡显存:",-1)),s("span",Fe,n(l.memoryPerGPU)+" GB",1)]),s("div",Me,[e[18]||(e[18]=s("span",{class:"label"},"利用率:",-1)),t(Y,{percentage:l.utilization,color:M(l.utilization)},null,8,["percentage","color"])])])],10,Ie))),128))])]),_:1})]),_:1})]),_:1}),t(B,{modelValue:v.value,"onUpdate:modelValue":e[7]||(e[7]=l=>v.value=l),title:"创建调度任务",width:"600px"},{footer:a(()=>[t(g,{onClick:e[6]||(e[6]=l=>v.value=!1)},{default:a(()=>e[19]||(e[19]=[u("取消",-1)])),_:1,__:[19]}),t(g,{type:"primary",onClick:j},{default:a(()=>e[20]||(e[20]=[u("创建",-1)])),_:1,__:[20]})]),default:a(()=>[t(te,{model:m.value,"label-width":"120px"},{default:a(()=>[t(b,{label:"任务名称"},{default:a(()=>[t(x,{modelValue:m.value.taskName,"onUpdate:modelValue":e[1]||(e[1]=l=>m.value.taskName=l),placeholder:"请输入任务名称"},null,8,["modelValue"])]),_:1}),t(b,{label:"GPU类型"},{default:a(()=>[t(ee,{modelValue:m.value.gpuType,"onUpdate:modelValue":e[2]||(e[2]=l=>m.value.gpuType=l),placeholder:"请选择GPU类型",style:{width:"100%"}},{default:a(()=>[t(c,{label:"NVIDIA A100",value:"NVIDIA A100"}),t(c,{label:"NVIDIA H100",value:"NVIDIA H100"}),t(c,{label:"昇腾 910B",value:"昇腾 910B"}),t(c,{label:"沐曦 C500",value:"沐曦 C500"}),t(c,{label:"海光 DCU",value:"海光 DCU"}),t(c,{label:"摩尔线程 MTT S80",value:"摩尔线程 MTT S80"}),t(c,{label:"阿里 PPU",value:"阿里 PPU"})]),_:1},8,["modelValue"])]),_:1}),t(b,{label:"GPU数量"},{default:a(()=>[t(I,{modelValue:m.value.gpuCount,"onUpdate:modelValue":e[3]||(e[3]=l=>m.value.gpuCount=l),min:1,max:8},null,8,["modelValue"])]),_:1}),t(b,{label:"显存需求(GB)"},{default:a(()=>[t(I,{modelValue:m.value.memoryRequired,"onUpdate:modelValue":e[4]||(e[4]=l=>m.value.memoryRequired=l),min:16,max:80,step:8},null,8,["modelValue"])]),_:1}),t(b,{label:"模型名称"},{default:a(()=>[t(x,{modelValue:m.value.modelName,"onUpdate:modelValue":e[5]||(e[5]=l=>m.value.modelName=l),placeholder:"请输入模型名称"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),t(B,{modelValue:k.value,"onUpdate:modelValue":e[8]||(e[8]=l=>k.value=l),title:"调度任务详情",width:"700px"},{default:a(()=>[i.value?(d(),D(le,{key:0,column:2,border:""},{default:a(()=>[t(p,{label:"任务名称"},{default:a(()=>[u(n(i.value.taskName),1)]),_:1}),t(p,{label:"模型名称"},{default:a(()=>[u(n(i.value.modelName),1)]),_:1}),t(p,{label:"GPU类型"},{default:a(()=>[u(n(i.value.gpuType),1)]),_:1}),t(p,{label:"GPU数量"},{default:a(()=>[u(n(i.value.gpuCount)+" 卡",1)]),_:1}),t(p,{label:"显存需求"},{default:a(()=>[u(n(i.value.memoryRequired)+" GB",1)]),_:1}),t(p,{label:"匹配节点"},{default:a(()=>[i.value.matchedNode?(d(),r("span",ze,n(i.value.matchedNode),1)):(d(),r("span",je,"-"))]),_:1}),t(p,{label:"调度状态"},{default:a(()=>[t(U,{type:G(i.value.status)},{default:a(()=>[u(n(w(i.value.status)),1)]),_:1},8,["type"])]),_:1}),t(p,{label:"创建时间"},{default:a(()=>[u(n(i.value.createTime),1)]),_:1})]),_:1})):P("",!0),i.value?.scheduleLog?(d(),r("div",He,[e[21]||(e[21]=s("h3",{class:"font-bold mb-2"},"调度日志",-1)),t(oe,null,{default:a(()=>[(d(!0),r(L,null,$(i.value.scheduleLog,(l,T)=>(d(),D(ae,{key:T,timestamp:l.time,placement:"top",type:l.type},{default:a(()=>[u(n(l.message),1)]),_:2},1032,["timestamp","type"]))),128))]),_:1})])):P("",!0)]),_:1},8,["modelValue"])])}}}),Dt=ie(Oe,[["__scopeId","data-v-ecc68410"]]);export{Dt as default};
