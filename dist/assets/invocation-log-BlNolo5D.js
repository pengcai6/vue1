import{d as Z,r as g,D as P,j as ee,c as te,a as e,w as t,o as B,b as h,i as s,p as r,L as ae,E as le,e as z,bf as oe,b8 as se,m as ne,n as ie,l as A,_ as re}from"./index-BX2sZVyW.js";import{E as ue}from"./dialog-BbJ9SoMc.js";import{E as de,a as pe}from"./descriptions-item-CLkKtAVA.js";import{E as me}from"./pagination-uLtAnqW5.js";/* empty css            */import{E as ce,a as fe}from"./select-9k77N6f3.js";import"./scrollbar-C9NSq6wy.js";import{E as ve}from"./input-5aB7ALv6.js";import{a as _e,E as ye}from"./table-column-DG__lvqo.js";import"./checkbox-B8dDd1Mj.js";import{E as ge,a as be}from"./col-DfCBUvxB.js";import{E as ke}from"./card-B6phTZGW.js";import{E as he}from"./statistic-BIQ42bG3.js";import{E as we,a as Te}from"./form-item-BCUJoI1X.js";import{E as Ce}from"./date-picker-CMS_m3WO.js";import{E as Ee}from"./button-Cn9gqGCu.js";import{E as Ne}from"./index-BFcHm1-Q.js";import"./event-BORzi4vc.js";import"./scroll-g5r06U3K.js";import"./index-PwB6y63X.js";import"./isEqual-ohjdCfDM.js";import"./strings-JcT2fde-.js";import"./debounce-DYp1oJWc.js";import"./isPlainObject-jZyBOBeK.js";import"./_baseClone-BOpOh07B.js";import"./index-BDj3Pv7k.js";const Ie={class:"invocation-log-page"},Pe={class:"card-header"},Se={class:"pagination"},Ve=Z({__name:"invocation-log",setup(xe){const u=g({serviceName:"",endpoint:"",statusCode:"",apiKey:"",dateRange:[]}),S=g([]),w=P(()=>{const l=T.value,a=l.length,v=l.filter(n=>n.statusCode===200).length,c=a>0?v/a*100:0,p=a>0?l.reduce((n,_)=>n+_.latency,0)/a:0,f=l.reduce((n,_)=>n+_.totalTokens,0);return{totalCalls:a,successRate:c,avgLatency:Math.round(p),totalTokens:f}}),y=g(1),b=g(10),I=g(!1),i=g(null),O=()=>{const l=[{id:"req-1719123456789-abc123",serviceName:"qwen-chat-api",endpoint:"/v1/chat/completions",method:"POST",statusCode:200,apiKey:"sk-1234567890abcdef1234567890abcdef",userId:"user-001",latency:1234,ttft:150,tps:45,organization:"研发部",modelName:"Qwen2.5-72B-Instruct",inputTokens:156,outputTokens:423,totalTokens:579,estimatedCost:"0.0289",ipAddress:"192.168.1.100",location:"北京市 朝阳区",timestamp:"2024-06-20 10:30:45",requestBody:JSON.stringify({model:"Qwen2.5-72B-Instruct",messages:[{role:"user",content:"请介绍一下人工智能的发展历程"}],temperature:.7,max_tokens:500},null,2),responseBody:JSON.stringify({id:"chatcmpl-abc123",choices:[{message:{role:"assistant",content:"人工智能的发展历程可以追溯到20世纪50年代..."},finish_reason:"stop"}],usage:{prompt_tokens:156,completion_tokens:423,total_tokens:579}},null,2)},{id:"req-1719123460123-def456",serviceName:"deepseek-inference",endpoint:"/v1/chat/completions",method:"POST",statusCode:200,apiKey:"sk-abcdefgh1234567890abcdefgh123456",userId:"user-002",latency:2156,ttft:200,tps:52,organization:"市场部",modelName:"DeepSeek-V3",inputTokens:234,outputTokens:678,totalTokens:912,estimatedCost:"0.0456",ipAddress:"192.168.1.105",location:"上海市 浦东新区",timestamp:"2024-06-20 11:15:20",requestBody:JSON.stringify({model:"DeepSeek-V3",messages:[{role:"user",content:"如何优化大模型推理性能？"}],temperature:.8},null,2),responseBody:JSON.stringify({id:"chatcmpl-def456",choices:[{message:{role:"assistant",content:"优化大模型推理性能可以从以下几个方面入手..."},finish_reason:"stop"}],usage:{prompt_tokens:234,completion_tokens:678,total_tokens:912}},null,2)},{id:"req-1719123465789-ghi789",serviceName:"qwen-chat-api",endpoint:"/v1/chat/completions",method:"POST",statusCode:401,apiKey:"sk-invalid-key-12345",userId:"unknown",latency:45,ttft:0,tps:0,organization:"未知",modelName:"",inputTokens:0,outputTokens:0,totalTokens:0,estimatedCost:"0.00",ipAddress:"203.0.113.50",location:"未知地区",timestamp:"2024-06-20 12:05:15",requestBody:JSON.stringify({model:"Qwen2.5-72B-Instruct",messages:[{role:"user",content:"Hello"}]},null,2),responseBody:JSON.stringify({error:{message:"Invalid API key",type:"invalid_request_error"}},null,2)},{id:"req-1719123470234-jkl012",serviceName:"glm-service",endpoint:"/v1/chat/completions",method:"POST",statusCode:200,apiKey:"sk-glm-key-xyz987654321",userId:"user-003",latency:1567,ttft:180,tps:48,organization:"产品部",modelName:"GLM-4-Plus",inputTokens:189,outputTokens:512,totalTokens:701,estimatedCost:"0.0351",ipAddress:"192.168.1.110",location:"深圳市 南山区",timestamp:"2024-06-20 13:20:30",requestBody:JSON.stringify({model:"GLM-4-Plus",messages:[{role:"user",content:"请写一段Python代码实现快速排序"}],temperature:.5},null,2),responseBody:JSON.stringify({id:"chatcmpl-jkl012",choices:[{message:{role:"assistant",content:"以下是Python实现的快速排序代码：\n```python\ndef quicksort(arr):\n    ..."},finish_reason:"stop"}],usage:{prompt_tokens:189,completion_tokens:512,total_tokens:701}},null,2)},{id:"req-1719123475678-mno345",serviceName:"qwen-chat-api",endpoint:"/v1/chat/completions",method:"POST",statusCode:500,apiKey:"sk-1234567890abcdef1234567890abcdef",userId:"user-001",latency:5023,ttft:0,tps:0,organization:"研发部",modelName:"Qwen2.5-72B-Instruct",inputTokens:0,outputTokens:0,totalTokens:0,estimatedCost:"0.00",ipAddress:"192.168.1.100",location:"北京市 朝阳区",timestamp:"2024-06-20 14:10:50",requestBody:JSON.stringify({model:"Qwen2.5-72B-Instruct",messages:[{role:"user",content:"测试请求"}]},null,2),responseBody:JSON.stringify({error:{message:"Internal server error",type:"server_error"}},null,2)}];S.value=l},V=()=>{O()},T=P(()=>{let l=S.value;if(u.value.serviceName&&(l=l.filter(a=>a.serviceName===u.value.serviceName)),u.value.endpoint&&(l=l.filter(a=>a.endpoint.includes(u.value.endpoint))),u.value.statusCode&&(l=l.filter(a=>a.statusCode===Number(u.value.statusCode))),u.value.apiKey&&(l=l.filter(a=>a.apiKey.includes(u.value.apiKey))),u.value.dateRange&&u.value.dateRange.length===2){const[a,v]=u.value.dateRange;l=l.filter(c=>{const p=new Date(c.timestamp).getTime();return p>=a.getTime()&&p<=v.getTime()})}return l}),q=P(()=>{const l=(y.value-1)*b.value,a=l+b.value;return T.value.slice(l,a)}),K=()=>{y.value=1},D=()=>{u.value={serviceName:"",endpoint:"",statusCode:"",apiKey:"",dateRange:[]},y.value=1},L=()=>{V(),A.success("数据已刷新")},R=l=>{i.value=l,I.value=!0},U=()=>{const l=["日志ID","服务名称","API端点","状态码","耗时(ms)","TTFT(ms)","TPS","组织","API Key","IP地址","模型","总Token","费用($)","调用时间"],a=T.value.map(n=>[n.id,n.serviceName,n.endpoint,n.statusCode,n.latency,n.ttft,n.tps,n.organization,n.apiKey,n.ipAddress,n.modelName,n.totalTokens,n.estimatedCost,n.timestamp]),v=[l.join(","),...a.map(n=>n.join(","))].join(`
`),c=new Blob(["\uFEFF"+v],{type:"text/csv;charset=utf-8;"}),p=URL.createObjectURL(c),f=document.createElement("a");f.href=p,f.download=`invocation-logs-${Date.now()}.csv`,document.body.appendChild(f),f.click(),document.body.removeChild(f),URL.revokeObjectURL(p),A.success("日志导出成功")},J=l=>l.length<=8?l:l.substring(0,8)+"..."+l.substring(l.length-4),x=l=>l>=200&&l<300?"success":l>=400&&l<500?"warning":l>=500?"danger":"info",j=l=>l<1e3?"#67c23a":l<3e3?"#e6a23c":"#f56c6c",F=l=>{b.value=l,y.value=1},M=l=>{y.value=l};return ee(()=>{V()}),(l,a)=>{const v=le,c=Ee,p=fe,f=ce,n=Te,_=ve,Q=Ce,$=we,C=he,k=ke,E=be,G=ge,m=ye,N=Ne,H=_e,W=me,d=de,X=pe,Y=ue;return B(),te("div",Ie,[e(k,null,{header:t(()=>[h("div",Pe,[a[12]||(a[12]=h("span",{class:"title"},"API调用日志",-1)),h("div",null,[e(c,{type:"primary",onClick:U},{default:t(()=>[e(v,null,{default:t(()=>[e(z(oe))]),_:1}),a[10]||(a[10]=s(" 导出日志 ",-1))]),_:1,__:[10]}),e(c,{type:"success",onClick:L},{default:t(()=>[e(v,null,{default:t(()=>[e(z(se))]),_:1}),a[11]||(a[11]=s(" 刷新 ",-1))]),_:1,__:[11]})])])]),default:t(()=>[e($,{inline:!0,class:"search-form"},{default:t(()=>[e(n,{label:"服务名称"},{default:t(()=>[e(f,{modelValue:u.value.serviceName,"onUpdate:modelValue":a[0]||(a[0]=o=>u.value.serviceName=o),placeholder:"请选择服务",clearable:"",style:{width:"180px"}},{default:t(()=>[e(p,{label:"全部",value:""}),e(p,{label:"qwen-chat-api",value:"qwen-chat-api"}),e(p,{label:"deepseek-inference",value:"deepseek-inference"}),e(p,{label:"glm-service",value:"glm-service"})]),_:1},8,["modelValue"])]),_:1}),e(n,{label:"API端点"},{default:t(()=>[e(_,{modelValue:u.value.endpoint,"onUpdate:modelValue":a[1]||(a[1]=o=>u.value.endpoint=o),placeholder:"请输入API端点",clearable:"",style:{width:"180px"}},null,8,["modelValue"])]),_:1}),e(n,{label:"状态码"},{default:t(()=>[e(f,{modelValue:u.value.statusCode,"onUpdate:modelValue":a[2]||(a[2]=o=>u.value.statusCode=o),placeholder:"请选择状态码",clearable:"",style:{width:"120px"}},{default:t(()=>[e(p,{label:"全部",value:""}),e(p,{label:"200",value:"200"}),e(p,{label:"400",value:"400"}),e(p,{label:"401",value:"401"}),e(p,{label:"500",value:"500"})]),_:1},8,["modelValue"])]),_:1}),e(n,{label:"API Key"},{default:t(()=>[e(_,{modelValue:u.value.apiKey,"onUpdate:modelValue":a[3]||(a[3]=o=>u.value.apiKey=o),placeholder:"请输入API Key",clearable:"",style:{width:"150px"}},null,8,["modelValue"])]),_:1}),e(n,{label:"时间范围"},{default:t(()=>[e(Q,{modelValue:u.value.dateRange,"onUpdate:modelValue":a[4]||(a[4]=o=>u.value.dateRange=o),type:"datetimerange","range-separator":"至","start-placeholder":"开始时间","end-placeholder":"结束时间",style:{width:"380px"}},null,8,["modelValue"])]),_:1}),e(n,null,{default:t(()=>[e(c,{type:"primary",onClick:K},{default:t(()=>a[13]||(a[13]=[s("查询",-1)])),_:1,__:[13]}),e(c,{onClick:D},{default:t(()=>a[14]||(a[14]=[s("重置",-1)])),_:1,__:[14]})]),_:1})]),_:1}),e(G,{gutter:20,style:{"margin-bottom":"20px"}},{default:t(()=>[e(E,{span:6},{default:t(()=>[e(k,{shadow:"hover"},{default:t(()=>[e(C,{title:"总调用次数",value:w.value.totalCalls},{suffix:t(()=>a[15]||(a[15]=[s("次",-1)])),_:1},8,["value"])]),_:1})]),_:1}),e(E,{span:6},{default:t(()=>[e(k,{shadow:"hover"},{default:t(()=>[e(C,{title:"成功率",value:w.value.successRate,precision:2},{suffix:t(()=>a[16]||(a[16]=[s("%",-1)])),_:1},8,["value"])]),_:1})]),_:1}),e(E,{span:6},{default:t(()=>[e(k,{shadow:"hover"},{default:t(()=>[e(C,{title:"平均延迟",value:w.value.avgLatency},{suffix:t(()=>a[17]||(a[17]=[s("ms",-1)])),_:1},8,["value"])]),_:1})]),_:1}),e(E,{span:6},{default:t(()=>[e(k,{shadow:"hover"},{default:t(()=>[e(C,{title:"总Token消耗",value:w.value.totalTokens},{suffix:t(()=>a[18]||(a[18]=[s("tokens",-1)])),_:1},8,["value"])]),_:1})]),_:1})]),_:1}),e(H,{data:q.value,border:"",style:{width:"100%"}},{default:t(()=>[e(m,{prop:"id",label:"请求ID",width:"160","show-overflow-tooltip":""}),e(m,{prop:"serviceName",label:"服务名称",width:"150"}),e(m,{prop:"endpoint",label:"API端点",width:"180","show-overflow-tooltip":""}),e(m,{prop:"method",label:"方法",width:"80",align:"center"},{default:t(({row:o})=>[e(N,{type:o.method==="POST"?"primary":"success",size:"small"},{default:t(()=>[s(r(o.method),1)]),_:2},1032,["type"])]),_:1}),e(m,{prop:"statusCode",label:"状态码",width:"100",align:"center"},{default:t(({row:o})=>[e(N,{type:x(o.statusCode)},{default:t(()=>[s(r(o.statusCode),1)]),_:2},1032,["type"])]),_:1}),e(m,{prop:"apiKey",label:"API Key",width:"150","show-overflow-tooltip":""},{default:t(({row:o})=>[s(r(J(o.apiKey)),1)]),_:1}),e(m,{prop:"latency",label:"延迟(ms)",width:"100",align:"center"},{default:t(({row:o})=>[h("span",{style:ae({color:j(o.latency)})},r(o.latency),5)]),_:1}),e(m,{prop:"ttft",label:"TTFT(ms)",width:"100",align:"center"}),e(m,{prop:"tps",label:"TPS",width:"80",align:"center"}),e(m,{prop:"organization",label:"组织",width:"120","show-overflow-tooltip":""}),e(m,{prop:"inputTokens",label:"输入tokens",width:"110",align:"center"}),e(m,{prop:"outputTokens",label:"输出tokens",width:"110",align:"center"}),e(m,{prop:"totalTokens",label:"总tokens",width:"100",align:"center"}),e(m,{prop:"ipAddress",label:"IP地址",width:"140"}),e(m,{prop:"timestamp",label:"请求时间",width:"180"}),e(m,{label:"操作",width:"100",fixed:"right"},{default:t(({row:o})=>[e(c,{link:"",type:"primary",size:"small",onClick:Be=>R(o)},{default:t(()=>a[19]||(a[19]=[s("详情",-1)])),_:2,__:[19]},1032,["onClick"])]),_:1})]),_:1},8,["data"]),h("div",Se,[e(W,{"current-page":y.value,"onUpdate:currentPage":a[5]||(a[5]=o=>y.value=o),"page-size":b.value,"onUpdate:pageSize":a[6]||(a[6]=o=>b.value=o),"page-sizes":[10,20,50,100],total:T.value.length,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:F,onCurrentChange:M},null,8,["current-page","page-size","total"])])]),_:1}),e(Y,{modelValue:I.value,"onUpdate:modelValue":a[9]||(a[9]=o=>I.value=o),title:"调用详情",width:"900px"},{default:t(()=>[i.value?(B(),ne(X,{key:0,column:2,border:""},{default:t(()=>[e(d,{label:"请求ID",span:2},{default:t(()=>[s(r(i.value.id),1)]),_:1}),e(d,{label:"服务名称"},{default:t(()=>[s(r(i.value.serviceName),1)]),_:1}),e(d,{label:"API端点"},{default:t(()=>[s(r(i.value.endpoint),1)]),_:1}),e(d,{label:"请求方法"},{default:t(()=>[e(N,{type:i.value.method==="POST"?"primary":"success"},{default:t(()=>[s(r(i.value.method),1)]),_:1},8,["type"])]),_:1}),e(d,{label:"状态码"},{default:t(()=>[e(N,{type:x(i.value.statusCode)},{default:t(()=>[s(r(i.value.statusCode),1)]),_:1},8,["type"])]),_:1}),e(d,{label:"API Key"},{default:t(()=>[s(r(i.value.apiKey),1)]),_:1}),e(d,{label:"用户标识"},{default:t(()=>[s(r(i.value.userId),1)]),_:1}),e(d,{label:"请求延迟"},{default:t(()=>[s(r(i.value.latency)+"ms",1)]),_:1}),e(d,{label:"TTFT"},{default:t(()=>[s(r(i.value.ttft)+"ms",1)]),_:1}),e(d,{label:"TPS"},{default:t(()=>[s(r(i.value.tps),1)]),_:1}),e(d,{label:"组织"},{default:t(()=>[s(r(i.value.organization),1)]),_:1}),e(d,{label:"模型名称"},{default:t(()=>[s(r(i.value.modelName),1)]),_:1}),e(d,{label:"输入tokens"},{default:t(()=>[s(r(i.value.inputTokens),1)]),_:1}),e(d,{label:"输出tokens"},{default:t(()=>[s(r(i.value.outputTokens),1)]),_:1}),e(d,{label:"总tokens"},{default:t(()=>[s(r(i.value.totalTokens),1)]),_:1}),e(d,{label:"费用估算"},{default:t(()=>[s("¥"+r(i.value.estimatedCost),1)]),_:1}),e(d,{label:"IP地址"},{default:t(()=>[s(r(i.value.ipAddress),1)]),_:1}),e(d,{label:"地理位置"},{default:t(()=>[s(r(i.value.location),1)]),_:1}),e(d,{label:"请求时间",span:2},{default:t(()=>[s(r(i.value.timestamp),1)]),_:1}),e(d,{label:"请求体",span:2},{default:t(()=>[e(_,{modelValue:i.value.requestBody,"onUpdate:modelValue":a[7]||(a[7]=o=>i.value.requestBody=o),type:"textarea",rows:6,readonly:"",style:{"font-family":"monospace","font-size":"12px"}},null,8,["modelValue"])]),_:1}),e(d,{label:"响应体",span:2},{default:t(()=>[e(_,{modelValue:i.value.responseBody,"onUpdate:modelValue":a[8]||(a[8]=o=>i.value.responseBody=o),type:"textarea",rows:6,readonly:"",style:{"font-family":"monospace","font-size":"12px"}},null,8,["modelValue"])]),_:1})]),_:1})):ie("",!0)]),_:1},8,["modelValue"])])}}}),st=re(Ve,[["__scopeId","data-v-6c778c44"]]);export{st as default};
