import{d as ye,r as f,y as T,h as ge,b as I,o as g,f as l,w as t,a as r,t as b,e as i,E as be,C as W,aN as he,j as Ee,F as we,A as Ve,c as P,aW as Ce,_ as xe}from"./index-C1LNxWrc.js";import{E as ke}from"./dialog-D1_iS1Vq.js";/* empty css                       */import{E as Re,a as Se}from"./checkbox-D429Hkk4.js";import{E as Ue,a as Ne}from"./radio-BfCnrhE6.js";import{E as Ae}from"./input-LGwqt1-Y.js";import{E as qe}from"./input-number-BdlakYFh.js";import{E as ze}from"./empty-BrxsyPU7.js";import{E as Te,a as Ie}from"./timeline-item-p9HOzw6X.js";import{E as Pe,a as De}from"./col-BHj47XkZ.js";import{E as $e}from"./statistic-D5rvesja.js";import{E as Fe}from"./card-bOHwtd_N.js";import{E as Ge,a as Be}from"./table-column-QOtjyKSd.js";import"./scrollbar-CWDB5A-B.js";import{E as Me}from"./switch-Ds6BDbF-.js";/* empty css            */import{E as Le,a as Qe}from"./form-item-BZC8dQDK.js";import{E as Oe,a as Ke}from"./select-BSsX693L.js";import{E as We}from"./button-CfgjJGa2.js";import{g as Y,s as h}from"./storage-2nKQMLp0.js";import{E as Ye}from"./index-gsKI2Iim.js";import{E as je}from"./index-B9Nwm2NO.js";import{E}from"./index-JFsgmBjq.js";import"./index-DaWWsILK.js";import"./scroll-RLo4NxSV.js";import"./index-DRLRXOGd.js";import"./use-form-common-props-dMO5F-Xy.js";import"./isEqual-CFwnnDW_.js";import"./index-BPEUnmM4.js";import"./index-BYwYey8Q.js";import"./_initCloneObject-T9RaIEd1.js";import"./isPlainObject-BS8VhLgB.js";import"./_baseIteratee-CNffayvf.js";import"./debounce-C4p0xsPh.js";import"./validator-DJAEN8sI.js";import"./_baseClone-0EgoVDGI.js";import"./strings-BOPxCUMK.js";const He={class:"alert-management-page"},Je={class:"card-header"},Xe={class:"card-header"},Ze={class:"alert-item"},el={class:"alert-header"},ll={class:"alert-title"},tl={class:"alert-content"},al={class:"alert-footer"},ol={class:"alert-service"},nl={key:0,class:"empty-state"},x="alert_rules_data",D="alerts_data",rl=ye({__name:"alert-management",setup(sl){const d=f([]),u=f({name:"",severity:"",enabled:""}),_=f(!1),k=f("create"),U=f(),n=f({id:"",name:"",metric:"",operator:"gt",threshold:80,duration:5,severity:"warning",notifyChannels:[],enabled:!0}),j={name:[{required:!0,message:"请输入规则名称",trigger:"blur"}],metric:[{required:!0,message:"请选择监控指标",trigger:"change"}],operator:[{required:!0,message:"请选择运算符",trigger:"change"}],threshold:[{required:!0,message:"请输入阈值",trigger:"blur"}],duration:[{required:!0,message:"请输入持续时间",trigger:"blur"}],severity:[{required:!0,message:"请选择告警级别",trigger:"change"}]},w=f([]),$=T(()=>w.value.slice(0,10)),N=T(()=>{const a=w.value.filter(e=>e.status==="active");return{critical:a.filter(e=>e.severity==="critical").length,warning:a.filter(e=>e.severity==="warning").length,info:a.filter(e=>e.severity==="info").length}}),H=()=>{const a=[{id:"rule-001",name:"GPU利用率过高",metric:"gpu_utilization",operator:"gt",threshold:85,duration:5,condition:"> 85% 持续5分钟",severity:"critical",notifyChannels:["email","sms","wechat"],enabled:!0,createdAt:"2024-01-10 10:00:00"},{id:"rule-002",name:"请求延迟告警",metric:"request_latency",operator:"gt",threshold:3e3,duration:3,condition:"> 3000ms 持续3分钟",severity:"warning",notifyChannels:["email","webhook"],enabled:!0,createdAt:"2024-02-15 14:30:00"},{id:"rule-003",name:"错误率异常",metric:"error_rate",operator:"gt",threshold:5,duration:2,condition:"> 5% 持续2分钟",severity:"critical",notifyChannels:["email","sms","wechat","webhook"],enabled:!0,createdAt:"2024-03-20 09:15:00"},{id:"rule-004",name:"内存使用率告警",metric:"memory_usage",operator:"gt",threshold:80,duration:5,condition:"> 80% 持续5分钟",severity:"warning",notifyChannels:["email"],enabled:!1,createdAt:"2024-04-12 16:20:00"},{id:"rule-005",name:"QPS过高",metric:"qps",operator:"gt",threshold:1e3,duration:1,condition:"> 1000 持续1分钟",severity:"info",notifyChannels:["email"],enabled:!0,createdAt:"2024-05-08 11:45:00"}],e=[{id:"alert-001",ruleId:"rule-001",ruleName:"GPU利用率过高",severity:"critical",serviceName:"qwen-chat-api",message:"GPU利用率达到 89%，超过阈值 85%，已持续 6 分钟",timestamp:"2024-06-20 14:30:25",status:"active"},{id:"alert-002",ruleId:"rule-002",ruleName:"请求延迟告警",severity:"warning",serviceName:"deepseek-inference",message:"平均请求延迟达到 3245ms，超过阈值 3000ms",timestamp:"2024-06-20 13:15:18",status:"resolved"},{id:"alert-003",ruleId:"rule-003",ruleName:"错误率异常",severity:"critical",serviceName:"glm-service",message:"错误率达到 7.2%，超过阈值 5%",timestamp:"2024-06-20 12:05:42",status:"resolved"},{id:"alert-004",ruleId:"rule-005",ruleName:"QPS过高",severity:"info",serviceName:"qwen-chat-api",message:"QPS达到 1250，超过阈值 1000",timestamp:"2024-06-20 11:30:10",status:"active"}];d.value=a,w.value=e,h(x,a),h(D,e)},F=()=>{const a=Y(x),e=Y(D);a&&Array.isArray(a)&&a.length>0?(d.value=a,w.value=e||[]):H()},J=T(()=>{let a=d.value;if(u.value.name&&(a=a.filter(e=>e.name.toLowerCase().includes(u.value.name.toLowerCase()))),u.value.severity&&(a=a.filter(e=>e.severity===u.value.severity)),u.value.enabled!==""){const e=u.value.enabled==="true";a=a.filter(m=>m.enabled===e)}return a}),X=()=>{},Z=()=>{u.value={name:"",severity:"",enabled:""}},ee=()=>{k.value="create",_.value=!0},le=a=>{k.value="edit",n.value={id:a.id,name:a.name,metric:a.metric,operator:a.operator,threshold:a.threshold,duration:a.duration,severity:a.severity,notifyChannels:[...a.notifyChannels],enabled:a.enabled},_.value=!0},te=a=>{je.confirm(`确定要删除告警规则"${a.name}"吗? 此操作不可恢复。`,"警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"error"}).then(()=>{const e=d.value.findIndex(m=>m.id===a.id);e>-1&&(d.value.splice(e,1),h(x,d.value),E.success("删除成功"))})},ae=a=>{h(x,d.value),E.success(a.enabled?"规则已启用":"规则已禁用")},oe=async()=>{await U.value.validate();const e=`${{gt:">",gte:">=",lt:"<",lte:"<=",eq:"=="}[n.value.operator]} ${n.value.threshold}${n.value.metric.includes("rate")||n.value.metric.includes("utilization")?"%":""} 持续${n.value.duration}分钟`;if(k.value==="create"){const m={...n.value,id:`rule-${Date.now()}`,condition:e,createdAt:new Date().toLocaleString("zh-CN")};d.value.unshift(m),E.success("创建成功")}else{const m=d.value.findIndex(v=>v.id===n.value.id);m>-1&&(d.value[m]={...d.value[m],...n.value,condition:e},E.success("更新成功"))}h(x,d.value),_.value=!1},ne=()=>{U.value?.resetFields(),n.value={id:"",name:"",metric:"",operator:"gt",threshold:80,duration:5,severity:"warning",notifyChannels:[],enabled:!0}},re=()=>{F(),E.success("数据已刷新")},se=a=>{a.status="resolved",h(D,w.value),E.success("告警已标记为已解决")},ie=a=>({gpu_utilization:"GPU利用率",memory_usage:"内存使用率",request_latency:"请求延迟",error_rate:"错误率",qps:"QPS",pod_status:"Pod状态"})[a]||a,G=a=>({critical:"严重",warning:"警告",info:"信息"})[a]||a,B=a=>({critical:"danger",warning:"warning",info:"info"})[a]||"",ue=a=>({critical:"danger",warning:"warning",info:"primary"})[a]||"primary";return ge(()=>{F()}),(a,e)=>{const m=be,v=We,M=Ae,p=Qe,s=Ke,R=Oe,L=Le,c=Be,A=Ye,Q=Me,de=Ge,y=Fe,V=Pe,q=$e,O=De,me=Ie,pe=Te,ve=ze,K=qe,z=Ne,fe=Ue,S=Se,_e=Re,ce=ke;return g(),I("div",He,[l(O,{gutter:20},{default:t(()=>[l(V,{span:14},{default:t(()=>[l(y,null,{header:t(()=>[i("div",Je,[e[14]||(e[14]=i("span",{class:"title"},"告警规则",-1)),l(v,{type:"primary",size:"small",onClick:ee},{default:t(()=>[l(m,null,{default:t(()=>[l(W(he))]),_:1}),e[13]||(e[13]=r(" 创建规则 ",-1))]),_:1,__:[13]})])]),default:t(()=>[l(L,{inline:!0,class:"search-form"},{default:t(()=>[l(p,{label:"规则名称"},{default:t(()=>[l(M,{modelValue:u.value.name,"onUpdate:modelValue":e[0]||(e[0]=o=>u.value.name=o),placeholder:"请输入规则名称",clearable:"",style:{width:"150px"}},null,8,["modelValue"])]),_:1}),l(p,{label:"告警级别"},{default:t(()=>[l(R,{modelValue:u.value.severity,"onUpdate:modelValue":e[1]||(e[1]=o=>u.value.severity=o),placeholder:"请选择级别",clearable:"",style:{width:"120px"}},{default:t(()=>[l(s,{label:"全部",value:""}),l(s,{label:"严重",value:"critical"}),l(s,{label:"警告",value:"warning"}),l(s,{label:"信息",value:"info"})]),_:1},8,["modelValue"])]),_:1}),l(p,{label:"状态"},{default:t(()=>[l(R,{modelValue:u.value.enabled,"onUpdate:modelValue":e[2]||(e[2]=o=>u.value.enabled=o),placeholder:"请选择状态",clearable:"",style:{width:"120px"}},{default:t(()=>[l(s,{label:"全部",value:""}),l(s,{label:"已启用",value:"true"}),l(s,{label:"已禁用",value:"false"})]),_:1},8,["modelValue"])]),_:1}),l(p,null,{default:t(()=>[l(v,{type:"primary",onClick:X},{default:t(()=>e[15]||(e[15]=[r("查询",-1)])),_:1,__:[15]}),l(v,{onClick:Z},{default:t(()=>e[16]||(e[16]=[r("重置",-1)])),_:1,__:[16]})]),_:1})]),_:1}),l(de,{data:J.value,border:"",style:{width:"100%"}},{default:t(()=>[l(c,{prop:"name",label:"规则名称",width:"180","show-overflow-tooltip":""}),l(c,{prop:"metric",label:"监控指标",width:"150"},{default:t(({row:o})=>[r(b(ie(o.metric)),1)]),_:1}),l(c,{prop:"condition",label:"触发条件",width:"140","show-overflow-tooltip":""}),l(c,{prop:"severity",label:"告警级别",width:"100",align:"center"},{default:t(({row:o})=>[l(A,{type:B(o.severity)},{default:t(()=>[r(b(G(o.severity)),1)]),_:2},1032,["type"])]),_:1}),l(c,{prop:"enabled",label:"状态",width:"90",align:"center"},{default:t(({row:o})=>[l(Q,{modelValue:o.enabled,"onUpdate:modelValue":C=>o.enabled=C,onChange:C=>ae(o),"active-text":o.enabled?"已启用":"已禁用"},null,8,["modelValue","onUpdate:modelValue","onChange","active-text"])]),_:1}),l(c,{label:"操作",width:"150",fixed:"right"},{default:t(({row:o})=>[l(v,{link:"",type:"primary",size:"small",onClick:C=>le(o)},{default:t(()=>e[17]||(e[17]=[r("编辑",-1)])),_:2,__:[17]},1032,["onClick"]),l(v,{link:"",type:"danger",size:"small",onClick:C=>te(o)},{default:t(()=>e[18]||(e[18]=[r("删除",-1)])),_:2,__:[18]},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1})]),_:1}),l(V,{span:10},{default:t(()=>[l(y,null,{header:t(()=>[i("div",Xe,[e[20]||(e[20]=i("span",{class:"title"},"告警历史",-1)),l(v,{type:"default",size:"small",onClick:re},{default:t(()=>[l(m,null,{default:t(()=>[l(W(Ce))]),_:1}),e[19]||(e[19]=r(" 刷新 ",-1))]),_:1,__:[19]})])]),default:t(()=>[l(O,{gutter:10,style:{"margin-bottom":"16px"}},{default:t(()=>[l(V,{span:8},{default:t(()=>[l(y,{shadow:"hover","body-style":{padding:"12px"}},{default:t(()=>[l(q,{title:"严重",value:N.value.critical},{suffix:t(()=>e[21]||(e[21]=[i("span",{style:{"font-size":"14px",color:"#f56c6c"}},"条",-1)])),_:1},8,["value"])]),_:1})]),_:1}),l(V,{span:8},{default:t(()=>[l(y,{shadow:"hover","body-style":{padding:"12px"}},{default:t(()=>[l(q,{title:"警告",value:N.value.warning},{suffix:t(()=>e[22]||(e[22]=[i("span",{style:{"font-size":"14px",color:"#e6a23c"}},"条",-1)])),_:1},8,["value"])]),_:1})]),_:1}),l(V,{span:8},{default:t(()=>[l(y,{shadow:"hover","body-style":{padding:"12px"}},{default:t(()=>[l(q,{title:"信息",value:N.value.info},{suffix:t(()=>e[23]||(e[23]=[i("span",{style:{"font-size":"14px",color:"#909399"}},"条",-1)])),_:1},8,["value"])]),_:1})]),_:1})]),_:1}),l(pe,null,{default:t(()=>[(g(!0),I(we,null,Ve($.value,o=>(g(),P(me,{key:o.id,timestamp:o.timestamp,type:ue(o.severity)},{default:t(()=>[l(y,{shadow:"hover"},{default:t(()=>[i("div",Ze,[i("div",el,[l(A,{type:B(o.severity),size:"small"},{default:t(()=>[r(b(G(o.severity)),1)]),_:2},1032,["type"]),i("span",ll,b(o.ruleName),1)]),i("div",tl,b(o.message),1),i("div",al,[i("span",ol,b(o.serviceName),1),o.status==="active"?(g(),P(v,{key:0,link:"",type:"primary",size:"small",onClick:C=>se(o)},{default:t(()=>e[24]||(e[24]=[r(" 标记已解决 ",-1)])),_:2,__:[24]},1032,["onClick"])):(g(),P(A,{key:1,type:"success",size:"small"},{default:t(()=>e[25]||(e[25]=[r("已解决",-1)])),_:1,__:[25]}))])])]),_:2},1024)]),_:2},1032,["timestamp","type"]))),128))]),_:1}),$.value.length===0?(g(),I("div",nl,[l(ve,{description:"暂无告警记录"})])):Ee("",!0)]),_:1})]),_:1})]),_:1}),l(ce,{modelValue:_.value,"onUpdate:modelValue":e[12]||(e[12]=o=>_.value=o),title:k.value==="create"?"创建告警规则":"编辑告警规则",width:"600px",onClose:ne},{footer:t(()=>[l(v,{onClick:e[11]||(e[11]=o=>_.value=!1)},{default:t(()=>e[34]||(e[34]=[r("取消",-1)])),_:1,__:[34]}),l(v,{type:"primary",onClick:oe},{default:t(()=>e[35]||(e[35]=[r("确定",-1)])),_:1,__:[35]})]),default:t(()=>[l(L,{model:n.value,rules:j,ref_key:"ruleFormRef",ref:U,"label-width":"100px"},{default:t(()=>[l(p,{label:"规则名称",prop:"name"},{default:t(()=>[l(M,{modelValue:n.value.name,"onUpdate:modelValue":e[3]||(e[3]=o=>n.value.name=o),placeholder:"请输入规则名称"},null,8,["modelValue"])]),_:1}),l(p,{label:"监控指标",prop:"metric"},{default:t(()=>[l(R,{modelValue:n.value.metric,"onUpdate:modelValue":e[4]||(e[4]=o=>n.value.metric=o),placeholder:"请选择监控指标",style:{width:"100%"}},{default:t(()=>[l(s,{label:"GPU利用率",value:"gpu_utilization"}),l(s,{label:"内存使用率",value:"memory_usage"}),l(s,{label:"请求延迟",value:"request_latency"}),l(s,{label:"错误率",value:"error_rate"}),l(s,{label:"QPS",value:"qps"}),l(s,{label:"Pod状态",value:"pod_status"})]),_:1},8,["modelValue"])]),_:1}),l(p,{label:"比较运算符",prop:"operator"},{default:t(()=>[l(R,{modelValue:n.value.operator,"onUpdate:modelValue":e[5]||(e[5]=o=>n.value.operator=o),placeholder:"请选择运算符",style:{width:"100%"}},{default:t(()=>[l(s,{label:"大于 >",value:"gt"}),l(s,{label:"大于等于 >=",value:"gte"}),l(s,{label:"小于 <",value:"lt"}),l(s,{label:"小于等于 <=",value:"lte"}),l(s,{label:"等于 ==",value:"eq"})]),_:1},8,["modelValue"])]),_:1}),l(p,{label:"阈值",prop:"threshold"},{default:t(()=>[l(K,{modelValue:n.value.threshold,"onUpdate:modelValue":e[6]||(e[6]=o=>n.value.threshold=o),min:0,max:100,style:{width:"100%"}},null,8,["modelValue"])]),_:1}),l(p,{label:"持续时间",prop:"duration"},{default:t(()=>[l(K,{modelValue:n.value.duration,"onUpdate:modelValue":e[7]||(e[7]=o=>n.value.duration=o),min:1,max:60,style:{width:"100%"}},null,8,["modelValue"]),e[26]||(e[26]=i("span",{style:{"margin-left":"8px",color:"#909399"}},"分钟",-1))]),_:1,__:[26]}),l(p,{label:"告警级别",prop:"severity"},{default:t(()=>[l(fe,{modelValue:n.value.severity,"onUpdate:modelValue":e[8]||(e[8]=o=>n.value.severity=o)},{default:t(()=>[l(z,{label:"critical"},{default:t(()=>e[27]||(e[27]=[r("严重",-1)])),_:1,__:[27]}),l(z,{label:"warning"},{default:t(()=>e[28]||(e[28]=[r("警告",-1)])),_:1,__:[28]}),l(z,{label:"info"},{default:t(()=>e[29]||(e[29]=[r("信息",-1)])),_:1,__:[29]})]),_:1},8,["modelValue"])]),_:1}),l(p,{label:"通知方式",prop:"notifyChannels"},{default:t(()=>[l(_e,{modelValue:n.value.notifyChannels,"onUpdate:modelValue":e[9]||(e[9]=o=>n.value.notifyChannels=o)},{default:t(()=>[l(S,{label:"email"},{default:t(()=>e[30]||(e[30]=[r("邮件",-1)])),_:1,__:[30]}),l(S,{label:"sms"},{default:t(()=>e[31]||(e[31]=[r("短信",-1)])),_:1,__:[31]}),l(S,{label:"webhook"},{default:t(()=>e[32]||(e[32]=[r("Webhook",-1)])),_:1,__:[32]}),l(S,{label:"wechat"},{default:t(()=>e[33]||(e[33]=[r("企业微信",-1)])),_:1,__:[33]})]),_:1},8,["modelValue"])]),_:1}),l(p,{label:"启用规则",prop:"enabled"},{default:t(()=>[l(Q,{modelValue:n.value.enabled,"onUpdate:modelValue":e[10]||(e[10]=o=>n.value.enabled=o)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}}),Ol=xe(rl,[["__scopeId","data-v-d8b20ae7"]]);export{Ol as default};
