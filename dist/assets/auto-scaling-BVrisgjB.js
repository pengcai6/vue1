import{d as Y,r as g,h,a3 as ee,b,o as u,f as l,w as a,e as o,j as T,t as n,a as d,c as U,F as te,A as le,_ as ae}from"./index-C1LNxWrc.js";import{E as oe}from"./dialog-D1_iS1Vq.js";import{E as se,a as ie}from"./form-item-BZC8dQDK.js";import{E as ne}from"./input-LGwqt1-Y.js";import{E as me}from"./input-number-BdlakYFh.js";import{E as re}from"./divider-cQog8eF3.js";import{E as ue,a as de}from"./col-BHj47XkZ.js";import{E as pe}from"./progress-D7FpNBk1.js";import{E as ce,a as fe}from"./timeline-item-p9HOzw6X.js";import{E as ve,a as _e}from"./table-column-QOtjyKSd.js";import"./checkbox-D429Hkk4.js";import"./scrollbar-CWDB5A-B.js";import{E as ge}from"./popover-DP0DHMQv.js";import{E as be}from"./button-CfgjJGa2.js";import{E as xe}from"./switch-Ds6BDbF-.js";/* empty css            */import{E as Ve}from"./card-bOHwtd_N.js";import{s as Z,g as F}from"./storage-2nKQMLp0.js";import{E as Te}from"./index-gsKI2Iim.js";import{E as C}from"./index-JFsgmBjq.js";import"./index-DaWWsILK.js";import"./scroll-RLo4NxSV.js";import"./index-DRLRXOGd.js";import"./_initCloneObject-T9RaIEd1.js";import"./use-form-common-props-dMO5F-Xy.js";import"./_baseClone-0EgoVDGI.js";import"./index-BPEUnmM4.js";import"./index-BYwYey8Q.js";import"./isPlainObject-BS8VhLgB.js";import"./_baseIteratee-CNffayvf.js";import"./isEqual-CFwnnDW_.js";import"./debounce-C4p0xsPh.js";import"./validator-DJAEN8sI.js";const Ee={class:"auto-scaling-page"},ye={class:"flex items-center justify-between"},Re={class:"text-sm"},Ue={key:0},Ne={key:1},ke={key:2},Ce={key:3},Se={class:"font-bold"},Pe={class:"text-sm text-gray-600"},ze={class:"text-sm text-gray-500"},Me={class:"metrics-panel"},Ze={class:"metric-item"},Fe={class:"metric-value"},qe={class:"text-2xl font-bold"},we={class:"metric-item mt-4"},Ie={class:"metric-value text-3xl font-bold text-blue-600"},De={class:"metric-item mt-4"},Be={class:"metric-value text-3xl font-bold text-green-600"},Ge={class:"metric-item mt-4"},Qe={class:"metric-value text-3xl font-bold text-purple-600"},$e={class:"metric-item mt-4"},Ae={class:"metric-value text-3xl font-bold text-orange-600"},je=Y({__name:"auto-scaling",setup(Le){const p=g([]),E=g([]),_=g(!1),x=g(!1),r=g({gpuUtilization:65,qps:120,tps:850,ttft:180,currentReplicas:3}),s=g({ruleName:"",serviceName:"",metrics:{gpuUtilization:80,qps:100,tps:1e3,ttft:200},minReplicas:1,maxReplicas:10,scaleToZero:!0,scaleToZeroTimeout:10,enabled:!0});let N;function q(){return{rules:[{id:"1",ruleName:"llama2-auto-scaling",serviceName:"llama2-7b-service",metrics:{gpuUtilization:80,qps:100,ttft:200},minReplicas:1,maxReplicas:10,scaleToZero:!0,scaleToZeroTimeout:10,enabled:!0},{id:"2",ruleName:"chatglm-auto-scaling",serviceName:"chatglm-6b-service",metrics:{gpuUtilization:75,tps:1e3},minReplicas:2,maxReplicas:8,scaleToZero:!1,enabled:!0}],events:[{id:"1",serviceName:"llama2-7b-service",action:"扩容",fromReplicas:2,toReplicas:3,reason:"GPU利用率达到85%，超过阈值80%",timestamp:"2024-01-15 14:30:00",type:"success"},{id:"2",serviceName:"chatglm-6b-service",action:"扩容",fromReplicas:2,toReplicas:4,reason:"QPS达到150，超过阈值100",timestamp:"2024-01-15 13:15:00",type:"success"},{id:"3",serviceName:"llama2-7b-service",action:"缩容",fromReplicas:3,toReplicas:1,reason:"10分钟无请求，触发缩容到0",timestamp:"2024-01-15 11:00:00",type:"info"}]}}function w(){N=window.setInterval(()=>{r.value.gpuUtilization=Math.floor(Math.random()*40+50),r.value.qps=Math.floor(Math.random()*100+80),r.value.tps=Math.floor(Math.random()*500+600),r.value.ttft=Math.floor(Math.random()*100+150)},3e3)}function I(i){return i<50?"#67C23A":i<80?"#E6A23C":"#F56C6C"}function D(i){x.value=!0,s.value={...i},_.value=!0}function B(){if(x.value&&s.value.id){const i=p.value.findIndex(e=>e.id===s.value.id);i!==-1&&(p.value[i]={...s.value})}else{const i={...s.value,id:Date.now().toString()};p.value.push(i)}y(),_.value=!1,$(),C.success(x.value?"规则更新成功":"规则创建成功")}function G(i){p.value=p.value.filter(e=>e.id!==i),y(),C.success("规则删除成功")}function Q(i){y(),C.success(i.enabled?"规则已启用":"规则已禁用")}function $(){x.value=!1,s.value={ruleName:"",serviceName:"",metrics:{gpuUtilization:80,qps:100,tps:1e3,ttft:200},minReplicas:1,maxReplicas:10,scaleToZero:!0,scaleToZeroTimeout:10,enabled:!0}}function y(){Z("scaling-rules",p.value),Z("scaling-events",E.value)}function A(){const i=F("scaling-rules",[]),e=F("scaling-events",[]);if(i.length===0||e.length===0){const c=q();p.value=c.rules,E.value=c.events,y()}else p.value=i,E.value=e}return h(()=>{A(),w()}),ee(()=>{N&&clearInterval(N)}),(i,e)=>{const c=Ve,V=be,f=_e,S=Te,k=xe,j=ge,L=ve,H=fe,J=ce,P=ue,K=pe,O=de,z=ne,m=ie,M=re,v=me,W=se,X=oe;return u(),b("div",Ee,[l(c,{class:"header-card"},{default:a(()=>e[14]||(e[14]=[o("h2",{class:"text-2xl font-bold mb-2"}," 基于推理指标的弹性扩缩容 ",-1),o("p",{class:"text-gray-500"}," 支持根据GPU利用率、QPS、TPS、TTFT指标进行弹性扩缩容，以应对高峰流量 ",-1)])),_:1,__:[14]}),l(O,{gutter:20,class:"mt-4"},{default:a(()=>[l(P,{span:16},{default:a(()=>[l(c,null,{header:a(()=>[o("div",ye,[e[16]||(e[16]=o("span",{class:"font-bold"},"扩缩容规则",-1)),l(V,{type:"primary",onClick:e[0]||(e[0]=t=>_.value=!0)},{default:a(()=>e[15]||(e[15]=[d(" 创建规则 ",-1)])),_:1,__:[15]})])]),default:a(()=>[l(L,{data:p.value,stripe:""},{default:a(()=>[l(f,{prop:"ruleName",label:"规则名称",width:"180"}),l(f,{prop:"serviceName",label:"服务名称",width:"150"}),l(f,{label:"扩缩容指标",width:"250"},{default:a(({row:t})=>[o("div",Re,[t.metrics.gpuUtilization?(u(),b("div",Ue," GPU利用率 > "+n(t.metrics.gpuUtilization)+"% ",1)):T("",!0),t.metrics.qps?(u(),b("div",Ne," QPS > "+n(t.metrics.qps),1)):T("",!0),t.metrics.tps?(u(),b("div",ke," TPS > "+n(t.metrics.tps),1)):T("",!0),t.metrics.ttft?(u(),b("div",Ce," TTFT > "+n(t.metrics.ttft)+"ms ",1)):T("",!0)])]),_:1}),l(f,{label:"副本范围",width:"120",align:"center"},{default:a(({row:t})=>[d(n(t.minReplicas)+" - "+n(t.maxReplicas),1)]),_:1}),l(f,{label:"缩容到0",width:"100",align:"center"},{default:a(({row:t})=>[t.scaleToZero?(u(),U(S,{key:0,type:"success",size:"small"},{default:a(()=>e[17]||(e[17]=[d(" 支持 ",-1)])),_:1,__:[17]})):(u(),U(S,{key:1,type:"info",size:"small"},{default:a(()=>e[18]||(e[18]=[d(" 不支持 ",-1)])),_:1,__:[18]}))]),_:1}),l(f,{label:"状态",width:"100",align:"center"},{default:a(({row:t})=>[l(k,{modelValue:t.enabled,"onUpdate:modelValue":R=>t.enabled=R,onChange:R=>Q(t)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),l(f,{label:"操作",width:"150",fixed:"right"},{default:a(({row:t})=>[l(V,{link:"",type:"primary",onClick:R=>D(t)},{default:a(()=>e[19]||(e[19]=[d(" 编辑 ",-1)])),_:2,__:[19]},1032,["onClick"]),l(j,{title:"确定要删除此规则吗？",onConfirm:R=>G(t.id)},{reference:a(()=>[l(V,{link:"",type:"danger"},{default:a(()=>e[20]||(e[20]=[d(" 删除 ",-1)])),_:1,__:[20]})]),_:2},1032,["onConfirm"])]),_:1})]),_:1},8,["data"])]),_:1}),l(c,{class:"mt-4"},{header:a(()=>e[21]||(e[21]=[o("span",{class:"font-bold"},"扩缩容历史",-1)])),default:a(()=>[l(J,null,{default:a(()=>[(u(!0),b(te,null,le(E.value,t=>(u(),U(H,{key:t.id,timestamp:t.timestamp,type:t.type,placement:"top"},{default:a(()=>[o("div",Se,n(t.serviceName),1),o("div",Pe,n(t.action)+"："+n(t.fromReplicas)+" → "+n(t.toReplicas)+" 副本 ",1),o("div",ze," 触发原因："+n(t.reason),1)]),_:2},1032,["timestamp","type"]))),128))]),_:1})]),_:1})]),_:1}),l(P,{span:8},{default:a(()=>[l(c,null,{header:a(()=>e[22]||(e[22]=[o("span",{class:"font-bold"},"实时监控指标",-1)])),default:a(()=>[o("div",Me,[o("div",Ze,[e[23]||(e[23]=o("div",{class:"metric-label"},"GPU利用率",-1)),o("div",Fe,[l(K,{type:"dashboard",percentage:r.value.gpuUtilization,color:I(r.value.gpuUtilization)},{default:a(({percentage:t})=>[o("span",qe,n(t)+"%",1)]),_:1},8,["percentage","color"])])]),o("div",we,[e[24]||(e[24]=o("div",{class:"metric-label"},"QPS (每秒查询数)",-1)),o("div",Ie,n(r.value.qps),1)]),o("div",De,[e[25]||(e[25]=o("div",{class:"metric-label"},"TPS (每秒Token数)",-1)),o("div",Be,n(r.value.tps),1)]),o("div",Ge,[e[26]||(e[26]=o("div",{class:"metric-label"},"TTFT (首Token时间)",-1)),o("div",Qe,n(r.value.ttft)+" ms ",1)]),o("div",$e,[e[27]||(e[27]=o("div",{class:"metric-label"},"当前副本数",-1)),o("div",Ae,n(r.value.currentReplicas),1)])])]),_:1})]),_:1})]),_:1}),l(X,{modelValue:_.value,"onUpdate:modelValue":e[13]||(e[13]=t=>_.value=t),title:x.value?"编辑扩缩容规则":"创建扩缩容规则",width:"700px"},{footer:a(()=>[l(V,{onClick:e[12]||(e[12]=t=>_.value=!1)},{default:a(()=>e[36]||(e[36]=[d("取消",-1)])),_:1,__:[36]}),l(V,{type:"primary",onClick:B},{default:a(()=>e[37]||(e[37]=[d("保存",-1)])),_:1,__:[37]})]),default:a(()=>[l(W,{model:s.value,"label-width":"140px"},{default:a(()=>[l(m,{label:"规则名称"},{default:a(()=>[l(z,{modelValue:s.value.ruleName,"onUpdate:modelValue":e[1]||(e[1]=t=>s.value.ruleName=t),placeholder:"请输入规则名称"},null,8,["modelValue"])]),_:1}),l(m,{label:"服务名称"},{default:a(()=>[l(z,{modelValue:s.value.serviceName,"onUpdate:modelValue":e[2]||(e[2]=t=>s.value.serviceName=t),placeholder:"请输入服务名称"},null,8,["modelValue"])]),_:1}),l(M,{"content-position":"left"},{default:a(()=>e[28]||(e[28]=[d("扩缩容触发指标",-1)])),_:1,__:[28]}),l(m,{label:"GPU利用率阈值(%)"},{default:a(()=>[l(v,{modelValue:s.value.metrics.gpuUtilization,"onUpdate:modelValue":e[3]||(e[3]=t=>s.value.metrics.gpuUtilization=t),min:0,max:100},null,8,["modelValue"]),e[29]||(e[29]=o("span",{class:"ml-2 text-gray-500 text-sm"},"超过此值触发扩容",-1))]),_:1,__:[29]}),l(m,{label:"QPS阈值"},{default:a(()=>[l(v,{modelValue:s.value.metrics.qps,"onUpdate:modelValue":e[4]||(e[4]=t=>s.value.metrics.qps=t),min:0,step:10},null,8,["modelValue"]),e[30]||(e[30]=o("span",{class:"ml-2 text-gray-500 text-sm"},"超过此值触发扩容",-1))]),_:1,__:[30]}),l(m,{label:"TPS阈值"},{default:a(()=>[l(v,{modelValue:s.value.metrics.tps,"onUpdate:modelValue":e[5]||(e[5]=t=>s.value.metrics.tps=t),min:0,step:100},null,8,["modelValue"]),e[31]||(e[31]=o("span",{class:"ml-2 text-gray-500 text-sm"},"超过此值触发扩容",-1))]),_:1,__:[31]}),l(m,{label:"TTFT阈值(ms)"},{default:a(()=>[l(v,{modelValue:s.value.metrics.ttft,"onUpdate:modelValue":e[6]||(e[6]=t=>s.value.metrics.ttft=t),min:0,step:50},null,8,["modelValue"]),e[32]||(e[32]=o("span",{class:"ml-2 text-gray-500 text-sm"},"超过此值触发扩容",-1))]),_:1,__:[32]}),l(M,{"content-position":"left"},{default:a(()=>e[33]||(e[33]=[d("副本配置",-1)])),_:1,__:[33]}),l(m,{label:"最小副本数"},{default:a(()=>[l(v,{modelValue:s.value.minReplicas,"onUpdate:modelValue":e[7]||(e[7]=t=>s.value.minReplicas=t),min:0,max:10},null,8,["modelValue"])]),_:1}),l(m,{label:"最大副本数"},{default:a(()=>[l(v,{modelValue:s.value.maxReplicas,"onUpdate:modelValue":e[8]||(e[8]=t=>s.value.maxReplicas=t),min:1,max:20},null,8,["modelValue"])]),_:1}),l(m,{label:"支持缩容到0"},{default:a(()=>[l(k,{modelValue:s.value.scaleToZero,"onUpdate:modelValue":e[9]||(e[9]=t=>s.value.scaleToZero=t)},null,8,["modelValue"]),e[34]||(e[34]=o("span",{class:"ml-2 text-gray-500 text-sm"},"一段时间无请求后缩容到0",-1))]),_:1,__:[34]}),s.value.scaleToZero?(u(),U(m,{key:0,label:"缩容等待时间"},{default:a(()=>[l(v,{modelValue:s.value.scaleToZeroTimeout,"onUpdate:modelValue":e[10]||(e[10]=t=>s.value.scaleToZeroTimeout=t),min:1,max:60},null,8,["modelValue"]),e[35]||(e[35]=o("span",{class:"ml-2 text-gray-500 text-sm"},"分钟",-1))]),_:1,__:[35]})):T("",!0),l(m,{label:"启用规则"},{default:a(()=>[l(k,{modelValue:s.value.enabled,"onUpdate:modelValue":e[11]||(e[11]=t=>s.value.enabled=t)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}}),Ut=ae(je,[["__scopeId","data-v-e1d1edad"]]);export{Ut as default};
