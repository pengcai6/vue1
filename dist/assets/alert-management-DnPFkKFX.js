import{d as ve,r as f,B as z,j as fe,c as D,a as l,w as t,o as g,i as r,n as b,b as i,E as _e,e as L,aN as ce,m as ye,F as ge,D as be,bd as he,l as I}from"./index-DAZDpghP.js";import{E as Ee}from"./dialog-CI4qXYgt.js";/* empty css                       */import{E as we,a as Ve}from"./checkbox-DDntw5na.js";import{E as Ce,a as xe}from"./radio-ChFPTsFt.js";import{E as ke}from"./input-BsUoEHjr.js";import{E as Re}from"./input-number-BUSsIkB9.js";import{E as Se}from"./empty-Ccmsp6rE.js";import{E as Ne,a as Ue}from"./timeline-item-D2GMA4fJ.js";import{E as qe,a as ze}from"./col-1pbAQj7U.js";import{E as De}from"./statistic-CqMGJr7U.js";import{E as Ie}from"./card-_e8Y2itV.js";import{a as Pe,E as Te}from"./table-column-CkszfM6q.js";import"./scrollbar-BKn1N4ug.js";import{E as Ae}from"./switch-BV5hNiQp.js";/* empty css            */import{E as $e,a as Fe}from"./form-item-D50nbGgb.js";import{E as Be,a as Ge}from"./select-B_Nc0zOl.js";import{E as Me}from"./button-CFFx6FdR.js";import{E as Qe}from"./index-i9SNigSW.js";import{E as Le}from"./index-TLwRQi5N.js";import{E as h}from"./index-B4p_U5VT.js";import{_ as je}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./event-D5_Wo8Xc.js";import"./scroll-PXqKi88e.js";import"./index-17xiCnpu.js";import"./isEqual-DlB8YXyV.js";import"./index-BBjiecLk.js";import"./isPlainObject-CnEW4LJ3.js";import"./_baseIteratee-DgY2c_zD.js";import"./debounce-Bv_84CHO.js";import"./validator-BGx-pjuX.js";import"./_baseClone-BBryStzM.js";import"./strings-BN0-5NCg.js";const Oe={class:"alert-management-page"},We={class:"card-header"},He={class:"card-header"},Je={class:"alert-item"},Ke={class:"alert-header"},Xe={class:"alert-title"},Ye={class:"alert-content"},Ze={class:"alert-footer"},el={class:"alert-service"},ll={key:0,class:"empty-state"},tl=ve({__name:"alert-management",setup(al){const v=f([]),u=f({name:"",severity:"",enabled:""}),_=f(!1),V=f("create"),k=f(),n=f({id:"",name:"",metric:"",operator:"gt",threshold:80,duration:5,severity:"warning",notifyChannels:[],enabled:!0}),j={name:[{required:!0,message:"请输入规则名称",trigger:"blur"}],metric:[{required:!0,message:"请选择监控指标",trigger:"change"}],operator:[{required:!0,message:"请选择运算符",trigger:"change"}],threshold:[{required:!0,message:"请输入阈值",trigger:"blur"}],duration:[{required:!0,message:"请输入持续时间",trigger:"blur"}],severity:[{required:!0,message:"请选择告警级别",trigger:"change"}]},R=f([]),P=z(()=>R.value.slice(0,10)),S=z(()=>{const o=R.value.filter(e=>e.status==="active");return{critical:o.filter(e=>e.severity==="critical").length,warning:o.filter(e=>e.severity==="warning").length,info:o.filter(e=>e.severity==="info").length}}),O=()=>{const o=[{id:"rule-001",name:"GPU利用率过高",metric:"gpu_utilization",operator:"gt",threshold:85,duration:5,condition:"> 85% 持续5分钟",severity:"critical",notifyChannels:["email","sms","wechat"],enabled:!0,createdAt:"2024-01-10 10:00:00"},{id:"rule-002",name:"请求延迟告警",metric:"request_latency",operator:"gt",threshold:3e3,duration:3,condition:"> 3000ms 持续3分钟",severity:"warning",notifyChannels:["email","webhook"],enabled:!0,createdAt:"2024-02-15 14:30:00"},{id:"rule-003",name:"错误率异常",metric:"error_rate",operator:"gt",threshold:5,duration:2,condition:"> 5% 持续2分钟",severity:"critical",notifyChannels:["email","sms","wechat","webhook"],enabled:!0,createdAt:"2024-03-20 09:15:00"},{id:"rule-004",name:"内存使用率告警",metric:"memory_usage",operator:"gt",threshold:80,duration:5,condition:"> 80% 持续5分钟",severity:"warning",notifyChannels:["email"],enabled:!1,createdAt:"2024-04-12 16:20:00"},{id:"rule-005",name:"QPS过高",metric:"qps",operator:"gt",threshold:1e3,duration:1,condition:"> 1000 持续1分钟",severity:"info",notifyChannels:["email"],enabled:!0,createdAt:"2024-05-08 11:45:00"}],e=[{id:"alert-001",ruleId:"rule-001",ruleName:"GPU利用率过高",severity:"critical",serviceName:"qwen-chat-api",message:"GPU利用率达到 89%，超过阈值 85%，已持续 6 分钟",timestamp:"2024-06-20 14:30:25",status:"active"},{id:"alert-002",ruleId:"rule-002",ruleName:"请求延迟告警",severity:"warning",serviceName:"deepseek-inference",message:"平均请求延迟达到 3245ms，超过阈值 3000ms",timestamp:"2024-06-20 13:15:18",status:"resolved"},{id:"alert-003",ruleId:"rule-003",ruleName:"错误率异常",severity:"critical",serviceName:"glm-service",message:"错误率达到 7.2%，超过阈值 5%",timestamp:"2024-06-20 12:05:42",status:"resolved"},{id:"alert-004",ruleId:"rule-005",ruleName:"QPS过高",severity:"info",serviceName:"qwen-chat-api",message:"QPS达到 1250，超过阈值 1000",timestamp:"2024-06-20 11:30:10",status:"active"}];v.value=o,R.value=e},T=()=>{O()},W=z(()=>{let o=v.value;if(u.value.name&&(o=o.filter(e=>e.name.toLowerCase().includes(u.value.name.toLowerCase()))),u.value.severity&&(o=o.filter(e=>e.severity===u.value.severity)),u.value.enabled!==""){const e=u.value.enabled==="true";o=o.filter(d=>d.enabled===e)}return o}),H=()=>{},J=()=>{u.value={name:"",severity:"",enabled:""}},K=()=>{V.value="create",_.value=!0},X=o=>{V.value="edit",n.value={id:o.id,name:o.name,metric:o.metric,operator:o.operator,threshold:o.threshold,duration:o.duration,severity:o.severity,notifyChannels:[...o.notifyChannels],enabled:o.enabled},_.value=!0},Y=o=>{Le.confirm(`确定要删除告警规则"${o.name}"吗? 此操作不可恢复。`,"警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"error"}).then(()=>{const e=v.value.findIndex(d=>d.id===o.id);e>-1&&(v.value.splice(e,1),h.success("删除成功"))})},Z=o=>{h.success(o.enabled?"规则已启用":"规则已禁用")},ee=async()=>{await k.value.validate();const e=`${{gt:">",gte:">=",lt:"<",lte:"<=",eq:"=="}[n.value.operator]} ${n.value.threshold}${n.value.metric.includes("rate")||n.value.metric.includes("utilization")?"%":""} 持续${n.value.duration}分钟`;if(V.value==="create"){const d={...n.value,id:`rule-${Date.now()}`,condition:e,createdAt:new Date().toLocaleString("zh-CN")};v.value.unshift(d),h.success("创建成功")}else{const d=v.value.findIndex(p=>p.id===n.value.id);d>-1&&(v.value[d]={...v.value[d],...n.value,condition:e},h.success("更新成功"))}_.value=!1},le=()=>{var o;(o=k.value)==null||o.resetFields(),n.value={id:"",name:"",metric:"",operator:"gt",threshold:80,duration:5,severity:"warning",notifyChannels:[],enabled:!0}},te=()=>{T(),h.success("数据已刷新")},ae=o=>{o.status="resolved",h.success("告警已标记为已解决")},oe=o=>({gpu_utilization:"GPU利用率",memory_usage:"内存使用率",request_latency:"请求延迟",error_rate:"错误率",qps:"QPS",pod_status:"Pod状态"})[o]||o,A=o=>({critical:"严重",warning:"警告",info:"信息"})[o]||o,$=o=>({critical:"danger",warning:"warning",info:"info"})[o]||"",ne=o=>({critical:"danger",warning:"warning",info:"primary"})[o]||"primary";return fe(()=>{T()}),(o,e)=>{const d=_e,p=Me,F=ke,m=Fe,s=Ge,C=Be,B=$e,c=Te,N=Qe,G=Ae,re=Pe,y=Ie,E=ze,U=De,M=qe,se=Ue,ie=Ne,ue=Se,Q=Re,q=xe,de=Ce,x=Ve,me=we,pe=Ee;return g(),D("div",Oe,[l(M,{gutter:20},{default:t(()=>[l(E,{span:14},{default:t(()=>[l(y,null,{header:t(()=>[i("div",We,[e[14]||(e[14]=i("span",{class:"title"},"告警规则",-1)),l(p,{type:"primary",size:"small",onClick:K},{default:t(()=>[l(d,null,{default:t(()=>[l(L(ce))]),_:1}),e[13]||(e[13]=r(" 创建规则 ",-1))]),_:1,__:[13]})])]),default:t(()=>[l(B,{inline:!0,class:"search-form"},{default:t(()=>[l(m,{label:"规则名称"},{default:t(()=>[l(F,{modelValue:u.value.name,"onUpdate:modelValue":e[0]||(e[0]=a=>u.value.name=a),placeholder:"请输入规则名称",clearable:"",style:{width:"150px"}},null,8,["modelValue"])]),_:1}),l(m,{label:"告警级别"},{default:t(()=>[l(C,{modelValue:u.value.severity,"onUpdate:modelValue":e[1]||(e[1]=a=>u.value.severity=a),placeholder:"请选择级别",clearable:"",style:{width:"120px"}},{default:t(()=>[l(s,{label:"全部",value:""}),l(s,{label:"严重",value:"critical"}),l(s,{label:"警告",value:"warning"}),l(s,{label:"信息",value:"info"})]),_:1},8,["modelValue"])]),_:1}),l(m,{label:"状态"},{default:t(()=>[l(C,{modelValue:u.value.enabled,"onUpdate:modelValue":e[2]||(e[2]=a=>u.value.enabled=a),placeholder:"请选择状态",clearable:"",style:{width:"120px"}},{default:t(()=>[l(s,{label:"全部",value:""}),l(s,{label:"已启用",value:"true"}),l(s,{label:"已禁用",value:"false"})]),_:1},8,["modelValue"])]),_:1}),l(m,null,{default:t(()=>[l(p,{type:"primary",onClick:H},{default:t(()=>e[15]||(e[15]=[r("查询",-1)])),_:1,__:[15]}),l(p,{onClick:J},{default:t(()=>e[16]||(e[16]=[r("重置",-1)])),_:1,__:[16]})]),_:1})]),_:1}),l(re,{data:W.value,border:"",style:{width:"100%"}},{default:t(()=>[l(c,{prop:"name",label:"规则名称",width:"180","show-overflow-tooltip":""}),l(c,{prop:"metric",label:"监控指标",width:"150"},{default:t(({row:a})=>[r(b(oe(a.metric)),1)]),_:1}),l(c,{prop:"condition",label:"触发条件",width:"140","show-overflow-tooltip":""}),l(c,{prop:"severity",label:"告警级别",width:"100",align:"center"},{default:t(({row:a})=>[l(N,{type:$(a.severity)},{default:t(()=>[r(b(A(a.severity)),1)]),_:2},1032,["type"])]),_:1}),l(c,{prop:"enabled",label:"状态",width:"90",align:"center"},{default:t(({row:a})=>[l(G,{modelValue:a.enabled,"onUpdate:modelValue":w=>a.enabled=w,onChange:w=>Z(a),"active-text":a.enabled?"已启用":"已禁用"},null,8,["modelValue","onUpdate:modelValue","onChange","active-text"])]),_:1}),l(c,{label:"操作",width:"150",fixed:"right"},{default:t(({row:a})=>[l(p,{link:"",type:"primary",size:"small",onClick:w=>X(a)},{default:t(()=>e[17]||(e[17]=[r("编辑",-1)])),_:2,__:[17]},1032,["onClick"]),l(p,{link:"",type:"danger",size:"small",onClick:w=>Y(a)},{default:t(()=>e[18]||(e[18]=[r("删除",-1)])),_:2,__:[18]},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1})]),_:1}),l(E,{span:10},{default:t(()=>[l(y,null,{header:t(()=>[i("div",He,[e[20]||(e[20]=i("span",{class:"title"},"告警历史",-1)),l(p,{type:"default",size:"small",onClick:te},{default:t(()=>[l(d,null,{default:t(()=>[l(L(he))]),_:1}),e[19]||(e[19]=r(" 刷新 ",-1))]),_:1,__:[19]})])]),default:t(()=>[l(M,{gutter:10,style:{"margin-bottom":"16px"}},{default:t(()=>[l(E,{span:8},{default:t(()=>[l(y,{shadow:"hover","body-style":{padding:"12px"}},{default:t(()=>[l(U,{title:"严重",value:S.value.critical},{suffix:t(()=>e[21]||(e[21]=[i("span",{style:{"font-size":"14px",color:"#f56c6c"}},"条",-1)])),_:1},8,["value"])]),_:1})]),_:1}),l(E,{span:8},{default:t(()=>[l(y,{shadow:"hover","body-style":{padding:"12px"}},{default:t(()=>[l(U,{title:"警告",value:S.value.warning},{suffix:t(()=>e[22]||(e[22]=[i("span",{style:{"font-size":"14px",color:"#e6a23c"}},"条",-1)])),_:1},8,["value"])]),_:1})]),_:1}),l(E,{span:8},{default:t(()=>[l(y,{shadow:"hover","body-style":{padding:"12px"}},{default:t(()=>[l(U,{title:"信息",value:S.value.info},{suffix:t(()=>e[23]||(e[23]=[i("span",{style:{"font-size":"14px",color:"#909399"}},"条",-1)])),_:1},8,["value"])]),_:1})]),_:1})]),_:1}),l(ie,null,{default:t(()=>[(g(!0),D(ge,null,be(P.value,a=>(g(),I(se,{key:a.id,timestamp:a.timestamp,type:ne(a.severity)},{default:t(()=>[l(y,{shadow:"hover"},{default:t(()=>[i("div",Je,[i("div",Ke,[l(N,{type:$(a.severity),size:"small"},{default:t(()=>[r(b(A(a.severity)),1)]),_:2},1032,["type"]),i("span",Xe,b(a.ruleName),1)]),i("div",Ye,b(a.message),1),i("div",Ze,[i("span",el,b(a.serviceName),1),a.status==="active"?(g(),I(p,{key:0,link:"",type:"primary",size:"small",onClick:w=>ae(a)},{default:t(()=>e[24]||(e[24]=[r(" 标记已解决 ",-1)])),_:2,__:[24]},1032,["onClick"])):(g(),I(N,{key:1,type:"success",size:"small"},{default:t(()=>e[25]||(e[25]=[r("已解决",-1)])),_:1,__:[25]}))])])]),_:2},1024)]),_:2},1032,["timestamp","type"]))),128))]),_:1}),P.value.length===0?(g(),D("div",ll,[l(ue,{description:"暂无告警记录"})])):ye("",!0)]),_:1})]),_:1})]),_:1}),l(pe,{modelValue:_.value,"onUpdate:modelValue":e[12]||(e[12]=a=>_.value=a),title:V.value==="create"?"创建告警规则":"编辑告警规则",width:"600px",onClose:le},{footer:t(()=>[l(p,{onClick:e[11]||(e[11]=a=>_.value=!1)},{default:t(()=>e[34]||(e[34]=[r("取消",-1)])),_:1,__:[34]}),l(p,{type:"primary",onClick:ee},{default:t(()=>e[35]||(e[35]=[r("确定",-1)])),_:1,__:[35]})]),default:t(()=>[l(B,{model:n.value,rules:j,ref_key:"ruleFormRef",ref:k,"label-width":"100px"},{default:t(()=>[l(m,{label:"规则名称",prop:"name"},{default:t(()=>[l(F,{modelValue:n.value.name,"onUpdate:modelValue":e[3]||(e[3]=a=>n.value.name=a),placeholder:"请输入规则名称"},null,8,["modelValue"])]),_:1}),l(m,{label:"监控指标",prop:"metric"},{default:t(()=>[l(C,{modelValue:n.value.metric,"onUpdate:modelValue":e[4]||(e[4]=a=>n.value.metric=a),placeholder:"请选择监控指标",style:{width:"100%"}},{default:t(()=>[l(s,{label:"GPU利用率",value:"gpu_utilization"}),l(s,{label:"内存使用率",value:"memory_usage"}),l(s,{label:"请求延迟",value:"request_latency"}),l(s,{label:"错误率",value:"error_rate"}),l(s,{label:"QPS",value:"qps"}),l(s,{label:"Pod状态",value:"pod_status"})]),_:1},8,["modelValue"])]),_:1}),l(m,{label:"比较运算符",prop:"operator"},{default:t(()=>[l(C,{modelValue:n.value.operator,"onUpdate:modelValue":e[5]||(e[5]=a=>n.value.operator=a),placeholder:"请选择运算符",style:{width:"100%"}},{default:t(()=>[l(s,{label:"大于 >",value:"gt"}),l(s,{label:"大于等于 >=",value:"gte"}),l(s,{label:"小于 <",value:"lt"}),l(s,{label:"小于等于 <=",value:"lte"}),l(s,{label:"等于 ==",value:"eq"})]),_:1},8,["modelValue"])]),_:1}),l(m,{label:"阈值",prop:"threshold"},{default:t(()=>[l(Q,{modelValue:n.value.threshold,"onUpdate:modelValue":e[6]||(e[6]=a=>n.value.threshold=a),min:0,max:100,style:{width:"100%"}},null,8,["modelValue"])]),_:1}),l(m,{label:"持续时间",prop:"duration"},{default:t(()=>[l(Q,{modelValue:n.value.duration,"onUpdate:modelValue":e[7]||(e[7]=a=>n.value.duration=a),min:1,max:60,style:{width:"100%"}},null,8,["modelValue"]),e[26]||(e[26]=i("span",{style:{"margin-left":"8px",color:"#909399"}},"分钟",-1))]),_:1,__:[26]}),l(m,{label:"告警级别",prop:"severity"},{default:t(()=>[l(de,{modelValue:n.value.severity,"onUpdate:modelValue":e[8]||(e[8]=a=>n.value.severity=a)},{default:t(()=>[l(q,{label:"critical"},{default:t(()=>e[27]||(e[27]=[r("严重",-1)])),_:1,__:[27]}),l(q,{label:"warning"},{default:t(()=>e[28]||(e[28]=[r("警告",-1)])),_:1,__:[28]}),l(q,{label:"info"},{default:t(()=>e[29]||(e[29]=[r("信息",-1)])),_:1,__:[29]})]),_:1},8,["modelValue"])]),_:1}),l(m,{label:"通知方式",prop:"notifyChannels"},{default:t(()=>[l(me,{modelValue:n.value.notifyChannels,"onUpdate:modelValue":e[9]||(e[9]=a=>n.value.notifyChannels=a)},{default:t(()=>[l(x,{label:"email"},{default:t(()=>e[30]||(e[30]=[r("邮件",-1)])),_:1,__:[30]}),l(x,{label:"sms"},{default:t(()=>e[31]||(e[31]=[r("短信",-1)])),_:1,__:[31]}),l(x,{label:"webhook"},{default:t(()=>e[32]||(e[32]=[r("Webhook",-1)])),_:1,__:[32]}),l(x,{label:"wechat"},{default:t(()=>e[33]||(e[33]=[r("企业微信",-1)])),_:1,__:[33]})]),_:1},8,["modelValue"])]),_:1}),l(m,{label:"启用规则",prop:"enabled"},{default:t(()=>[l(G,{modelValue:n.value.enabled,"onUpdate:modelValue":e[10]||(e[10]=a=>n.value.enabled=a)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}}),$l=je(tl,[["__scopeId","data-v-06354804"]]);export{$l as default};
