import{d as ee,r as g,y as V,h as te,b as le,o as B,f as e,w as t,e as b,a as s,t as i,I as ae,E as oe,C as A,b2 as se,aW as ne,c as re,j as ie,_ as ue}from"./index-C1LNxWrc.js";import{E as de}from"./dialog-D1_iS1Vq.js";import{E as pe,a as me}from"./descriptions-item-BClrjkTE.js";import{E as ce}from"./pagination-C_8mWErZ.js";/* empty css            */import{E as fe,a as ve}from"./select-BSsX693L.js";import"./scrollbar-CWDB5A-B.js";import{E as _e}from"./input-LGwqt1-Y.js";import{E as ge,a as ye}from"./table-column-QOtjyKSd.js";import"./checkbox-D429Hkk4.js";import{a as ke,E as be}from"./col-BHj47XkZ.js";import{E as he}from"./card-bOHwtd_N.js";import{E as we}from"./statistic-D5rvesja.js";import{E as Ce,a as Te}from"./form-item-BZC8dQDK.js";import{E as Ee}from"./date-picker-Cnmdp5g_.js";import{E as Ne}from"./button-CfgjJGa2.js";import{g as Ie,s as Se}from"./storage-2nKQMLp0.js";import{E as Ve}from"./index-gsKI2Iim.js";import{E as O}from"./index-JFsgmBjq.js";import"./index-DaWWsILK.js";import"./scroll-RLo4NxSV.js";import"./index-DRLRXOGd.js";import"./use-form-common-props-dMO5F-Xy.js";import"./isEqual-CFwnnDW_.js";import"./strings-BOPxCUMK.js";import"./_initCloneObject-T9RaIEd1.js";import"./index-BPEUnmM4.js";import"./debounce-C4p0xsPh.js";import"./_baseIteratee-CNffayvf.js";import"./isPlainObject-BS8VhLgB.js";import"./_baseClone-0EgoVDGI.js";import"./index-BYwYey8Q.js";const Pe={class:"invocation-log-page"},xe={class:"card-header"},Be={class:"pagination"},q="invocation_logs_data",Ae=ee({__name:"invocation-log",setup(Oe){const r=g({serviceName:"",endpoint:"",statusCode:"",apiKey:"",dateRange:[]}),N=g([]),h=V(()=>{const a=S.value,l=a.length,_=a.filter(m=>m.statusCode===200).length,c=l>0?_/l*100:0,d=l>0?a.reduce((m,f)=>m+f.latency,0)/l:0,w=a.reduce((m,f)=>m+f.totalTokens,0);return{totalCalls:l,successRate:c,avgLatency:Math.round(d),totalTokens:w}}),v=g(1),y=g(10),I=g(!1),n=g(null),K=()=>{const a=[{id:"req-1719123456789-abc123",serviceName:"qwen-chat-api",endpoint:"/v1/chat/completions",method:"POST",statusCode:200,apiKey:"sk-1234567890abcdef1234567890abcdef",userId:"user-001",latency:1234,modelName:"Qwen2.5-72B-Instruct",inputTokens:156,outputTokens:423,totalTokens:579,estimatedCost:"0.0289",ipAddress:"192.168.1.100",location:"北京市 朝阳区",timestamp:"2024-06-20 10:30:45",requestBody:JSON.stringify({model:"Qwen2.5-72B-Instruct",messages:[{role:"user",content:"请介绍一下人工智能的发展历程"}],temperature:.7,max_tokens:500},null,2),responseBody:JSON.stringify({id:"chatcmpl-abc123",choices:[{message:{role:"assistant",content:"人工智能的发展历程可以追溯到20世纪50年代..."},finish_reason:"stop"}],usage:{prompt_tokens:156,completion_tokens:423,total_tokens:579}},null,2)},{id:"req-1719123460123-def456",serviceName:"deepseek-inference",endpoint:"/v1/chat/completions",method:"POST",statusCode:200,apiKey:"sk-abcdefgh1234567890abcdefgh123456",userId:"user-002",latency:2156,modelName:"DeepSeek-V3",inputTokens:234,outputTokens:678,totalTokens:912,estimatedCost:"0.0456",ipAddress:"192.168.1.105",location:"上海市 浦东新区",timestamp:"2024-06-20 11:15:20",requestBody:JSON.stringify({model:"DeepSeek-V3",messages:[{role:"user",content:"如何优化大模型推理性能？"}],temperature:.8},null,2),responseBody:JSON.stringify({id:"chatcmpl-def456",choices:[{message:{role:"assistant",content:"优化大模型推理性能可以从以下几个方面入手..."},finish_reason:"stop"}],usage:{prompt_tokens:234,completion_tokens:678,total_tokens:912}},null,2)},{id:"req-1719123465789-ghi789",serviceName:"qwen-chat-api",endpoint:"/v1/chat/completions",method:"POST",statusCode:401,apiKey:"sk-invalid-key-12345",userId:"unknown",latency:45,modelName:"",inputTokens:0,outputTokens:0,totalTokens:0,estimatedCost:"0.00",ipAddress:"203.0.113.50",location:"未知地区",timestamp:"2024-06-20 12:05:15",requestBody:JSON.stringify({model:"Qwen2.5-72B-Instruct",messages:[{role:"user",content:"Hello"}]},null,2),responseBody:JSON.stringify({error:{message:"Invalid API key",type:"invalid_request_error"}},null,2)},{id:"req-1719123470234-jkl012",serviceName:"glm-service",endpoint:"/v1/chat/completions",method:"POST",statusCode:200,apiKey:"sk-glm-key-xyz987654321",userId:"user-003",latency:1567,modelName:"GLM-4-Plus",inputTokens:189,outputTokens:512,totalTokens:701,estimatedCost:"0.0351",ipAddress:"192.168.1.110",location:"深圳市 南山区",timestamp:"2024-06-20 13:20:30",requestBody:JSON.stringify({model:"GLM-4-Plus",messages:[{role:"user",content:"请写一段Python代码实现快速排序"}],temperature:.5},null,2),responseBody:JSON.stringify({id:"chatcmpl-jkl012",choices:[{message:{role:"assistant",content:"以下是Python实现的快速排序代码：\n```python\ndef quicksort(arr):\n    ..."},finish_reason:"stop"}],usage:{prompt_tokens:189,completion_tokens:512,total_tokens:701}},null,2)},{id:"req-1719123475678-mno345",serviceName:"qwen-chat-api",endpoint:"/v1/chat/completions",method:"POST",statusCode:500,apiKey:"sk-1234567890abcdef1234567890abcdef",userId:"user-001",latency:5023,modelName:"Qwen2.5-72B-Instruct",inputTokens:0,outputTokens:0,totalTokens:0,estimatedCost:"0.00",ipAddress:"192.168.1.100",location:"北京市 朝阳区",timestamp:"2024-06-20 14:10:50",requestBody:JSON.stringify({model:"Qwen2.5-72B-Instruct",messages:[{role:"user",content:"测试请求"}]},null,2),responseBody:JSON.stringify({error:{message:"Internal server error",type:"server_error"}},null,2)}];N.value=a,Se(q,a)},P=()=>{const a=Ie(q);a&&Array.isArray(a)&&a.length>0?N.value=a:K()},S=V(()=>{let a=N.value;if(r.value.serviceName&&(a=a.filter(l=>l.serviceName===r.value.serviceName)),r.value.endpoint&&(a=a.filter(l=>l.endpoint.includes(r.value.endpoint))),r.value.statusCode&&(a=a.filter(l=>l.statusCode===Number(r.value.statusCode))),r.value.apiKey&&(a=a.filter(l=>l.apiKey.includes(r.value.apiKey))),r.value.dateRange&&r.value.dateRange.length===2){const[l,_]=r.value.dateRange;a=a.filter(c=>{const d=new Date(c.timestamp).getTime();return d>=l.getTime()&&d<=_.getTime()})}return a}),z=V(()=>{const a=(v.value-1)*y.value,l=a+y.value;return S.value.slice(a,l)}),D=()=>{v.value=1},L=()=>{r.value={serviceName:"",endpoint:"",statusCode:"",apiKey:"",dateRange:[]},v.value=1},R=()=>{P(),O.success("数据已刷新")},J=a=>{n.value=a,I.value=!0},U=()=>{O.success("日志导出功能（演示模式）- 已生成 JSON 文件")},M=a=>a.length<=8?a:a.substring(0,8)+"..."+a.substring(a.length-4),x=a=>a>=200&&a<300?"success":a>=400&&a<500?"warning":a>=500?"danger":"info",Q=a=>a<1e3?"#67c23a":a<3e3?"#e6a23c":"#f56c6c",j=a=>{y.value=a,v.value=1},F=a=>{v.value=a};return te(()=>{P()}),(a,l)=>{const _=oe,c=Ne,d=ve,w=fe,m=Te,f=_e,G=Ee,H=Ce,C=we,k=he,T=be,W=ke,p=ye,E=Ve,Y=ge,$=ce,u=me,X=pe,Z=de;return B(),le("div",Pe,[e(k,null,{header:t(()=>[b("div",xe,[l[12]||(l[12]=b("span",{class:"title"},"API调用日志",-1)),b("div",null,[e(c,{type:"primary",onClick:U},{default:t(()=>[e(_,null,{default:t(()=>[e(A(se))]),_:1}),l[10]||(l[10]=s(" 导出日志 ",-1))]),_:1,__:[10]}),e(c,{type:"success",onClick:R},{default:t(()=>[e(_,null,{default:t(()=>[e(A(ne))]),_:1}),l[11]||(l[11]=s(" 刷新 ",-1))]),_:1,__:[11]})])])]),default:t(()=>[e(H,{inline:!0,class:"search-form"},{default:t(()=>[e(m,{label:"服务名称"},{default:t(()=>[e(w,{modelValue:r.value.serviceName,"onUpdate:modelValue":l[0]||(l[0]=o=>r.value.serviceName=o),placeholder:"请选择服务",clearable:"",style:{width:"180px"}},{default:t(()=>[e(d,{label:"全部",value:""}),e(d,{label:"qwen-chat-api",value:"qwen-chat-api"}),e(d,{label:"deepseek-inference",value:"deepseek-inference"}),e(d,{label:"glm-service",value:"glm-service"})]),_:1},8,["modelValue"])]),_:1}),e(m,{label:"API端点"},{default:t(()=>[e(f,{modelValue:r.value.endpoint,"onUpdate:modelValue":l[1]||(l[1]=o=>r.value.endpoint=o),placeholder:"请输入API端点",clearable:"",style:{width:"180px"}},null,8,["modelValue"])]),_:1}),e(m,{label:"状态码"},{default:t(()=>[e(w,{modelValue:r.value.statusCode,"onUpdate:modelValue":l[2]||(l[2]=o=>r.value.statusCode=o),placeholder:"请选择状态码",clearable:"",style:{width:"120px"}},{default:t(()=>[e(d,{label:"全部",value:""}),e(d,{label:"200",value:"200"}),e(d,{label:"400",value:"400"}),e(d,{label:"401",value:"401"}),e(d,{label:"500",value:"500"})]),_:1},8,["modelValue"])]),_:1}),e(m,{label:"API Key"},{default:t(()=>[e(f,{modelValue:r.value.apiKey,"onUpdate:modelValue":l[3]||(l[3]=o=>r.value.apiKey=o),placeholder:"请输入API Key",clearable:"",style:{width:"150px"}},null,8,["modelValue"])]),_:1}),e(m,{label:"时间范围"},{default:t(()=>[e(G,{modelValue:r.value.dateRange,"onUpdate:modelValue":l[4]||(l[4]=o=>r.value.dateRange=o),type:"datetimerange","range-separator":"至","start-placeholder":"开始时间","end-placeholder":"结束时间",style:{width:"380px"}},null,8,["modelValue"])]),_:1}),e(m,null,{default:t(()=>[e(c,{type:"primary",onClick:D},{default:t(()=>l[13]||(l[13]=[s("查询",-1)])),_:1,__:[13]}),e(c,{onClick:L},{default:t(()=>l[14]||(l[14]=[s("重置",-1)])),_:1,__:[14]})]),_:1})]),_:1}),e(W,{gutter:20,style:{"margin-bottom":"20px"}},{default:t(()=>[e(T,{span:6},{default:t(()=>[e(k,{shadow:"hover"},{default:t(()=>[e(C,{title:"总调用次数",value:h.value.totalCalls},{suffix:t(()=>l[15]||(l[15]=[s("次",-1)])),_:1},8,["value"])]),_:1})]),_:1}),e(T,{span:6},{default:t(()=>[e(k,{shadow:"hover"},{default:t(()=>[e(C,{title:"成功率",value:h.value.successRate,precision:2},{suffix:t(()=>l[16]||(l[16]=[s("%",-1)])),_:1},8,["value"])]),_:1})]),_:1}),e(T,{span:6},{default:t(()=>[e(k,{shadow:"hover"},{default:t(()=>[e(C,{title:"平均延迟",value:h.value.avgLatency},{suffix:t(()=>l[17]||(l[17]=[s("ms",-1)])),_:1},8,["value"])]),_:1})]),_:1}),e(T,{span:6},{default:t(()=>[e(k,{shadow:"hover"},{default:t(()=>[e(C,{title:"总Token消耗",value:h.value.totalTokens},{suffix:t(()=>l[18]||(l[18]=[s("tokens",-1)])),_:1},8,["value"])]),_:1})]),_:1})]),_:1}),e(Y,{data:z.value,border:"",style:{width:"100%"}},{default:t(()=>[e(p,{prop:"id",label:"请求ID",width:"160","show-overflow-tooltip":""}),e(p,{prop:"serviceName",label:"服务名称",width:"150"}),e(p,{prop:"endpoint",label:"API端点",width:"180","show-overflow-tooltip":""}),e(p,{prop:"method",label:"方法",width:"80",align:"center"},{default:t(({row:o})=>[e(E,{type:o.method==="POST"?"primary":"success",size:"small"},{default:t(()=>[s(i(o.method),1)]),_:2},1032,["type"])]),_:1}),e(p,{prop:"statusCode",label:"状态码",width:"100",align:"center"},{default:t(({row:o})=>[e(E,{type:x(o.statusCode)},{default:t(()=>[s(i(o.statusCode),1)]),_:2},1032,["type"])]),_:1}),e(p,{prop:"apiKey",label:"API Key",width:"150","show-overflow-tooltip":""},{default:t(({row:o})=>[s(i(M(o.apiKey)),1)]),_:1}),e(p,{prop:"latency",label:"延迟(ms)",width:"100",align:"center"},{default:t(({row:o})=>[b("span",{style:ae({color:Q(o.latency)})},i(o.latency),5)]),_:1}),e(p,{prop:"inputTokens",label:"输入tokens",width:"110",align:"center"}),e(p,{prop:"outputTokens",label:"输出tokens",width:"110",align:"center"}),e(p,{prop:"totalTokens",label:"总tokens",width:"100",align:"center"}),e(p,{prop:"ipAddress",label:"IP地址",width:"140"}),e(p,{prop:"timestamp",label:"请求时间",width:"180"}),e(p,{label:"操作",width:"100",fixed:"right"},{default:t(({row:o})=>[e(c,{link:"",type:"primary",size:"small",onClick:qe=>J(o)},{default:t(()=>l[19]||(l[19]=[s("详情",-1)])),_:2,__:[19]},1032,["onClick"])]),_:1})]),_:1},8,["data"]),b("div",Be,[e($,{"current-page":v.value,"onUpdate:currentPage":l[5]||(l[5]=o=>v.value=o),"page-size":y.value,"onUpdate:pageSize":l[6]||(l[6]=o=>y.value=o),"page-sizes":[10,20,50,100],total:S.value.length,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:j,onCurrentChange:F},null,8,["current-page","page-size","total"])])]),_:1}),e(Z,{modelValue:I.value,"onUpdate:modelValue":l[9]||(l[9]=o=>I.value=o),title:"调用详情",width:"900px"},{default:t(()=>[n.value?(B(),re(X,{key:0,column:2,border:""},{default:t(()=>[e(u,{label:"请求ID",span:2},{default:t(()=>[s(i(n.value.id),1)]),_:1}),e(u,{label:"服务名称"},{default:t(()=>[s(i(n.value.serviceName),1)]),_:1}),e(u,{label:"API端点"},{default:t(()=>[s(i(n.value.endpoint),1)]),_:1}),e(u,{label:"请求方法"},{default:t(()=>[e(E,{type:n.value.method==="POST"?"primary":"success"},{default:t(()=>[s(i(n.value.method),1)]),_:1},8,["type"])]),_:1}),e(u,{label:"状态码"},{default:t(()=>[e(E,{type:x(n.value.statusCode)},{default:t(()=>[s(i(n.value.statusCode),1)]),_:1},8,["type"])]),_:1}),e(u,{label:"API Key"},{default:t(()=>[s(i(n.value.apiKey),1)]),_:1}),e(u,{label:"用户标识"},{default:t(()=>[s(i(n.value.userId),1)]),_:1}),e(u,{label:"请求延迟"},{default:t(()=>[s(i(n.value.latency)+"ms",1)]),_:1}),e(u,{label:"模型名称"},{default:t(()=>[s(i(n.value.modelName),1)]),_:1}),e(u,{label:"输入tokens"},{default:t(()=>[s(i(n.value.inputTokens),1)]),_:1}),e(u,{label:"输出tokens"},{default:t(()=>[s(i(n.value.outputTokens),1)]),_:1}),e(u,{label:"总tokens"},{default:t(()=>[s(i(n.value.totalTokens),1)]),_:1}),e(u,{label:"费用估算"},{default:t(()=>[s("¥"+i(n.value.estimatedCost),1)]),_:1}),e(u,{label:"IP地址"},{default:t(()=>[s(i(n.value.ipAddress),1)]),_:1}),e(u,{label:"地理位置"},{default:t(()=>[s(i(n.value.location),1)]),_:1}),e(u,{label:"请求时间",span:2},{default:t(()=>[s(i(n.value.timestamp),1)]),_:1}),e(u,{label:"请求体",span:2},{default:t(()=>[e(f,{modelValue:n.value.requestBody,"onUpdate:modelValue":l[7]||(l[7]=o=>n.value.requestBody=o),type:"textarea",rows:6,readonly:"",style:{"font-family":"monospace","font-size":"12px"}},null,8,["modelValue"])]),_:1}),e(u,{label:"响应体",span:2},{default:t(()=>[e(f,{modelValue:n.value.responseBody,"onUpdate:modelValue":l[8]||(l[8]=o=>n.value.responseBody=o),type:"textarea",rows:6,readonly:"",style:{"font-family":"monospace","font-size":"12px"}},null,8,["modelValue"])]),_:1})]),_:1})):ie("",!0)]),_:1},8,["modelValue"])])}}}),ft=ue(Ae,[["__scopeId","data-v-b0481de9"]]);export{ft as default};
