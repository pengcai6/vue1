import{d as ce,r as p,y as U,h as ge,b as k,o as I,f as e,w as t,e as h,a as i,t as x,E as ve,C as ye,aN as fe,F as R,A as G,c as q,_ as _e}from"./index-C1LNxWrc.js";import{E as Te}from"./dialog-D1_iS1Vq.js";import{E as be,a as Ie}from"./radio-BfCnrhE6.js";import{E as Ve}from"./card-bOHwtd_N.js";import{E as we}from"./pagination-C_8mWErZ.js";/* empty css            */import{E as Ee,a as Ce}from"./select-BSsX693L.js";import"./scrollbar-CWDB5A-B.js";import"./input-LGwqt1-Y.js";import{E as Ne,a as ke}from"./table-column-QOtjyKSd.js";import"./checkbox-D429Hkk4.js";import{E as he,a as xe}from"./form-item-BZC8dQDK.js";import{E as Be}from"./button-CfgjJGa2.js";import{g as ze,s as B}from"./storage-2nKQMLp0.js";import{E as Ae}from"./index-gsKI2Iim.js";import{E as Pe}from"./index-B9Nwm2NO.js";import{E as z}from"./index-JFsgmBjq.js";import"./index-DaWWsILK.js";import"./scroll-RLo4NxSV.js";import"./index-DRLRXOGd.js";import"./use-form-common-props-dMO5F-Xy.js";import"./isEqual-CFwnnDW_.js";import"./strings-BOPxCUMK.js";import"./_initCloneObject-T9RaIEd1.js";import"./index-BPEUnmM4.js";import"./debounce-C4p0xsPh.js";import"./_baseIteratee-CNffayvf.js";import"./isPlainObject-BS8VhLgB.js";import"./_baseClone-0EgoVDGI.js";import"./validator-DJAEN8sI.js";const De={class:"resource-permission-page"},Se={class:"card-header"},Ue={class:"pagination"},w="resource_permissions_data",Re=ce({__name:"resource-permission",setup(Ge){const s=p({resourceType:"",granteeType:"",permission:""}),d=p([]),v=p(1),_=p(10),f=p(!1),V=p("create"),E=p(),o=p({id:"",resourceType:"",resourceId:"",granteeType:"",granteeId:"",permission:"read-only"}),F={resourceType:[{required:!0,message:"请选择资源类型",trigger:"change"}],resourceId:[{required:!0,message:"请选择资源",trigger:"change"}],granteeType:[{required:!0,message:"请选择授权对象类型",trigger:"change"}],granteeId:[{required:!0,message:"请选择授权对象",trigger:"change"}],permission:[{required:!0,message:"请选择权限级别",trigger:"change"}]},T=p([]),b=p([]),A={model:[{id:"model-001",name:"Qwen2.5-72B-Instruct"},{id:"model-002",name:"DeepSeek-V3"},{id:"model-003",name:"GLM-4-Plus"}],dataset:[{id:"dataset-001",name:"客服对话数据集"},{id:"dataset-002",name:"金融问答数据集"},{id:"dataset-003",name:"医疗诊断数据集"}],gpu:[{id:"gpu-pool-001",name:"NVIDIA A100 资源池"},{id:"gpu-pool-002",name:"昇腾910B 资源池"},{id:"gpu-pool-003",name:"沐曦C500 资源池"}],service:[{id:"service-001",name:"qwen-chat-api"},{id:"service-002",name:"deepseek-inference"},{id:"service-003",name:"glm-service"}]},P={user:[{id:"user-001",name:"张三"},{id:"user-002",name:"李四"},{id:"user-003",name:"王五"}],role:[{id:"role-developer",name:"开发者"},{id:"role-operator",name:"运维人员"},{id:"role-viewer",name:"访客"}],organization:[{id:"org-001",name:"技术研发部"},{id:"org-002",name:"产品部"},{id:"org-003",name:"AI实验室"}]},M=()=>{const r=[{id:"perm-001",resourceType:"model",resourceId:"model-001",resourceName:"Qwen2.5-72B-Instruct",granteeType:"user",granteeId:"user-001",granteeName:"张三",permission:"owner",createdBy:"管理员",createdAt:"2024-01-15 10:00:00"},{id:"perm-002",resourceType:"dataset",resourceId:"dataset-001",resourceName:"客服对话数据集",granteeType:"role",granteeId:"role-developer",granteeName:"开发者",permission:"read-write",createdBy:"管理员",createdAt:"2024-02-10 14:30:00"},{id:"perm-003",resourceType:"gpu",resourceId:"gpu-pool-001",resourceName:"NVIDIA A100 资源池",granteeType:"organization",granteeId:"org-001",granteeName:"技术研发部",permission:"read-write",createdBy:"管理员",createdAt:"2024-03-05 09:20:00"},{id:"perm-004",resourceType:"service",resourceId:"service-001",resourceName:"qwen-chat-api",granteeType:"role",granteeId:"role-viewer",granteeName:"访客",permission:"read-only",createdBy:"管理员",createdAt:"2024-04-12 16:45:00"},{id:"perm-005",resourceType:"model",resourceId:"model-002",resourceName:"DeepSeek-V3",granteeType:"user",granteeId:"user-002",granteeName:"李四",permission:"read-write",createdBy:"管理员",createdAt:"2024-05-08 11:15:00"}];d.value=r,B(w,r)},$=()=>{const r=ze(w);r&&Array.isArray(r)&&r.length>0?d.value=r:M()},D=U(()=>{let r=d.value;return s.value.resourceType&&(r=r.filter(a=>a.resourceType===s.value.resourceType)),s.value.granteeType&&(r=r.filter(a=>a.granteeType===s.value.granteeType)),s.value.permission&&(r=r.filter(a=>a.permission===s.value.permission)),r}),L=U(()=>{const r=(v.value-1)*_.value,a=r+_.value;return D.value.slice(r,a)}),O=()=>{v.value=1},Q=()=>{s.value={resourceType:"",granteeType:"",permission:""},v.value=1},j=()=>{V.value="create",f.value=!0},K=r=>{V.value="edit",o.value={id:r.id,resourceType:r.resourceType,resourceId:r.resourceId,granteeType:r.granteeType,granteeId:r.granteeId,permission:r.permission},T.value=A[r.resourceType]||[],b.value=P[r.granteeType]||[],f.value=!0},Y=r=>{Pe.confirm("确定要删除该权限规则吗? 此操作不可恢复。","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"error"}).then(()=>{const a=d.value.findIndex(u=>u.id===r.id);a>-1&&(d.value.splice(a,1),B(w,d.value),z.success("删除成功"))})},H=async()=>{await E.value.validate();const r=T.value.find(u=>u.id===o.value.resourceId),a=b.value.find(u=>u.id===o.value.granteeId);if(V.value==="create"){const u={id:`perm-${Date.now()}`,resourceType:o.value.resourceType,resourceId:o.value.resourceId,resourceName:r?.name||"",granteeType:o.value.granteeType,granteeId:o.value.granteeId,granteeName:a?.name||"",permission:o.value.permission,createdBy:"管理员",createdAt:new Date().toLocaleString("zh-CN")};d.value.unshift(u),z.success("创建成功")}else{const u=d.value.findIndex(m=>m.id===o.value.id);u>-1&&(d.value[u]={...d.value[u],resourceType:o.value.resourceType,resourceId:o.value.resourceId,resourceName:r?.name||"",granteeType:o.value.granteeType,granteeId:o.value.granteeId,granteeName:a?.name||"",permission:o.value.permission},z.success("更新成功"))}B(w,d.value),f.value=!1},J=()=>{E.value?.resetFields(),o.value={id:"",resourceType:"",resourceId:"",granteeType:"",granteeId:"",permission:"read-only"},T.value=[],b.value=[]},W=r=>{o.value.resourceId="",T.value=A[r]||[]},X=r=>{o.value.granteeId="",b.value=P[r]||[]},Z=r=>({model:"模型",dataset:"数据集",gpu:"GPU资源",service:"部署服务"})[r]||r,ee=r=>({model:"primary",dataset:"success",gpu:"warning",service:"danger"})[r]||"",ae=r=>({user:"用户",role:"角色",organization:"组织"})[r]||r,re=r=>({user:"primary",role:"success",organization:"warning"})[r]||"",le=r=>({owner:"所有者","read-write":"读写","read-only":"只读"})[r]||r,te=r=>({owner:"danger","read-write":"warning","read-only":"info"})[r]||"",oe=r=>{_.value=r,v.value=1},ne=r=>{v.value=r};return ge(()=>{$()}),(r,a)=>{const u=ve,m=Be,n=Ce,y=Ee,c=xe,S=he,g=ke,C=Ae,se=Ne,ue=we,ie=Ve,N=Ie,de=be,pe=Te;return I(),k("div",De,[e(ie,null,{header:t(()=>[h("div",Se,[a[13]||(a[13]=h("span",{class:"title"},"资源权限管控",-1)),e(m,{type:"primary",onClick:j},{default:t(()=>[e(u,null,{default:t(()=>[e(ye(fe))]),_:1}),a[12]||(a[12]=i(" 添加权限规则 ",-1))]),_:1,__:[12]})])]),default:t(()=>[e(S,{inline:!0,class:"search-form"},{default:t(()=>[e(c,{label:"资源类型"},{default:t(()=>[e(y,{modelValue:s.value.resourceType,"onUpdate:modelValue":a[0]||(a[0]=l=>s.value.resourceType=l),placeholder:"请选择资源类型",clearable:"",style:{width:"150px"}},{default:t(()=>[e(n,{label:"全部",value:""}),e(n,{label:"模型",value:"model"}),e(n,{label:"数据集",value:"dataset"}),e(n,{label:"GPU资源",value:"gpu"}),e(n,{label:"部署服务",value:"service"})]),_:1},8,["modelValue"])]),_:1}),e(c,{label:"授权对象"},{default:t(()=>[e(y,{modelValue:s.value.granteeType,"onUpdate:modelValue":a[1]||(a[1]=l=>s.value.granteeType=l),placeholder:"请选择授权对象",clearable:"",style:{width:"150px"}},{default:t(()=>[e(n,{label:"全部",value:""}),e(n,{label:"用户",value:"user"}),e(n,{label:"角色",value:"role"}),e(n,{label:"组织",value:"organization"})]),_:1},8,["modelValue"])]),_:1}),e(c,{label:"权限级别"},{default:t(()=>[e(y,{modelValue:s.value.permission,"onUpdate:modelValue":a[2]||(a[2]=l=>s.value.permission=l),placeholder:"请选择权限级别",clearable:"",style:{width:"150px"}},{default:t(()=>[e(n,{label:"全部",value:""}),e(n,{label:"所有者",value:"owner"}),e(n,{label:"读写",value:"read-write"}),e(n,{label:"只读",value:"read-only"})]),_:1},8,["modelValue"])]),_:1}),e(c,null,{default:t(()=>[e(m,{type:"primary",onClick:O},{default:t(()=>a[14]||(a[14]=[i("查询",-1)])),_:1,__:[14]}),e(m,{onClick:Q},{default:t(()=>a[15]||(a[15]=[i("重置",-1)])),_:1,__:[15]})]),_:1})]),_:1}),e(se,{data:L.value,border:"",style:{width:"100%"}},{default:t(()=>[e(g,{prop:"id",label:"规则ID",width:"140"}),e(g,{prop:"resourceType",label:"资源类型",width:"120"},{default:t(({row:l})=>[e(C,{type:ee(l.resourceType)},{default:t(()=>[i(x(Z(l.resourceType)),1)]),_:2},1032,["type"])]),_:1}),e(g,{prop:"resourceName",label:"资源名称",width:"200","show-overflow-tooltip":""}),e(g,{prop:"granteeType",label:"授权对象类型",width:"120",align:"center"},{default:t(({row:l})=>[e(C,{type:re(l.granteeType)},{default:t(()=>[i(x(ae(l.granteeType)),1)]),_:2},1032,["type"])]),_:1}),e(g,{prop:"granteeName",label:"授权对象",width:"150"}),e(g,{prop:"permission",label:"权限级别",width:"120",align:"center"},{default:t(({row:l})=>[e(C,{type:te(l.permission)},{default:t(()=>[i(x(le(l.permission)),1)]),_:2},1032,["type"])]),_:1}),e(g,{prop:"createdBy",label:"创建人",width:"100"}),e(g,{prop:"createdAt",label:"创建时间",width:"180"}),e(g,{label:"操作",width:"150",fixed:"right"},{default:t(({row:l})=>[e(m,{link:"",type:"primary",size:"small",onClick:me=>K(l)},{default:t(()=>a[16]||(a[16]=[i("编辑",-1)])),_:2,__:[16]},1032,["onClick"]),e(m,{link:"",type:"danger",size:"small",onClick:me=>Y(l)},{default:t(()=>a[17]||(a[17]=[i("删除",-1)])),_:2,__:[17]},1032,["onClick"])]),_:1})]),_:1},8,["data"]),h("div",Ue,[e(ue,{"current-page":v.value,"onUpdate:currentPage":a[3]||(a[3]=l=>v.value=l),"page-size":_.value,"onUpdate:pageSize":a[4]||(a[4]=l=>_.value=l),"page-sizes":[10,20,50,100],total:D.value.length,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:oe,onCurrentChange:ne},null,8,["current-page","page-size","total"])])]),_:1}),e(pe,{modelValue:f.value,"onUpdate:modelValue":a[11]||(a[11]=l=>f.value=l),title:V.value==="create"?"添加权限规则":"编辑权限规则",width:"600px",onClose:J},{footer:t(()=>[e(m,{onClick:a[10]||(a[10]=l=>f.value=!1)},{default:t(()=>a[21]||(a[21]=[i("取消",-1)])),_:1,__:[21]}),e(m,{type:"primary",onClick:H},{default:t(()=>a[22]||(a[22]=[i("确定",-1)])),_:1,__:[22]})]),default:t(()=>[e(S,{model:o.value,rules:F,ref_key:"formRef",ref:E,"label-width":"120px"},{default:t(()=>[e(c,{label:"资源类型",prop:"resourceType"},{default:t(()=>[e(y,{modelValue:o.value.resourceType,"onUpdate:modelValue":a[5]||(a[5]=l=>o.value.resourceType=l),placeholder:"请选择资源类型",onChange:W},{default:t(()=>[e(n,{label:"模型",value:"model"}),e(n,{label:"数据集",value:"dataset"}),e(n,{label:"GPU资源",value:"gpu"}),e(n,{label:"部署服务",value:"service"})]),_:1},8,["modelValue"])]),_:1}),e(c,{label:"资源",prop:"resourceId"},{default:t(()=>[e(y,{modelValue:o.value.resourceId,"onUpdate:modelValue":a[6]||(a[6]=l=>o.value.resourceId=l),placeholder:"请选择资源",filterable:""},{default:t(()=>[(I(!0),k(R,null,G(T.value,l=>(I(),q(n,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(c,{label:"授权对象类型",prop:"granteeType"},{default:t(()=>[e(y,{modelValue:o.value.granteeType,"onUpdate:modelValue":a[7]||(a[7]=l=>o.value.granteeType=l),placeholder:"请选择授权对象类型",onChange:X},{default:t(()=>[e(n,{label:"用户",value:"user"}),e(n,{label:"角色",value:"role"}),e(n,{label:"组织",value:"organization"})]),_:1},8,["modelValue"])]),_:1}),e(c,{label:"授权对象",prop:"granteeId"},{default:t(()=>[e(y,{modelValue:o.value.granteeId,"onUpdate:modelValue":a[8]||(a[8]=l=>o.value.granteeId=l),placeholder:"请选择授权对象",filterable:""},{default:t(()=>[(I(!0),k(R,null,G(b.value,l=>(I(),q(n,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(c,{label:"权限级别",prop:"permission"},{default:t(()=>[e(de,{modelValue:o.value.permission,"onUpdate:modelValue":a[9]||(a[9]=l=>o.value.permission=l)},{default:t(()=>[e(N,{label:"owner"},{default:t(()=>a[18]||(a[18]=[i("所有者（读写删除）",-1)])),_:1,__:[18]}),e(N,{label:"read-write"},{default:t(()=>a[19]||(a[19]=[i("读写",-1)])),_:1,__:[19]}),e(N,{label:"read-only"},{default:t(()=>a[20]||(a[20]=[i("只读",-1)])),_:1,__:[20]})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}}),va=_e(Re,[["__scopeId","data-v-e861d2bf"]]);export{va as default};
